<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>CMake Manual - Manuals</title>
        <link href="../../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">
        <link href="../../../extra.css" rel="stylesheet">

        <script src="../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../..">Manuals</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Programming <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">C++</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../C%2B%2B%20Debugging%20and%20Profiling/" class="dropdown-item">C++ Debugging and Profiling</a>
</li>
            
<li>
    <a href="../C%2B%2B%20Manual/" class="dropdown-item">C++ Manual</a>
</li>
            
<li>
    <a href="../C%2B%2B%20Workflow/" class="dropdown-item">C++ Workflow</a>
</li>
            
<li>
    <a href="./" class="dropdown-item active">CMake Manual</a>
</li>
            
<li>
    <a href="../Google%20Test/" class="dropdown-item">Google Test</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Database</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../Database/Database%20Workflow/" class="dropdown-item">Database Workflow</a>
</li>
            
<li>
    <a href="../../Database/PostgreSQL%20Debugging%20and%20Profiling/" class="dropdown-item">PostgreSQL Debugging and Profiling</a>
</li>
            
<li>
    <a href="../../Database/PostgreSQL%20Manual/" class="dropdown-item">PostgreSQL Manual</a>
</li>
            
<li>
    <a href="../../Database/SQL%20Manual/" class="dropdown-item">SQL Manual</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Java</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../Java/Debugging%20Java/" class="dropdown-item">Debugging Java</a>
</li>
            
<li>
    <a href="../../Java/Jackson/" class="dropdown-item">Jackson</a>
</li>
            
<li>
    <a href="../../Java/Java%20Manual/" class="dropdown-item">Java Manual</a>
</li>
            
<li>
    <a href="../../Java/Java%20Workflow/" class="dropdown-item">Java Workflow</a>
</li>
            
<li>
    <a href="../../Java/Maven/" class="dropdown-item">Maven</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Python</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../Python/Matplotlib%20Manual/" class="dropdown-item">Matplotlib Manual</a>
</li>
            
<li>
    <a href="../../Python/Pandas%20Manual/" class="dropdown-item">Pandas Manual</a>
</li>
            
<li>
    <a href="../../Python/Plotly%20Manual/" class="dropdown-item">Plotly Manual</a>
</li>
            
<li>
    <a href="../../Python/Python%20Debugging/" class="dropdown-item">Python Debugging</a>
</li>
            
<li>
    <a href="../../Python/Python%20Manual/" class="dropdown-item">Python Manual</a>
</li>
            
<li>
    <a href="../../Python/Python%20Workflow/" class="dropdown-item">Python Workflow</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Web</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../Web/CSS%20Manual/" class="dropdown-item">CSS Manual</a>
</li>
            
<li>
    <a href="../../Web/css/" class="dropdown-item">css</a>
</li>
            
<li>
    <a href="../../Web/Google%20API%20and%20Apps%20Script/" class="dropdown-item">Google API and Apps Script</a>
</li>
            
<li>
    <a href="../../Web/htaccess/" class="dropdown-item">htaccess</a>
</li>
            
<li>
    <a href="../../Web/JavaScript/" class="dropdown-item">JavaScript</a>
</li>
            
<li>
    <a href="../../Web/Jekyll/" class="dropdown-item">Jekyll</a>
</li>
            
<li>
    <a href="../../Web/mkdocs/" class="dropdown-item">mkdocs</a>
</li>
    </ul>
  </li>
                                    
<li>
    <a href="../../Common/" class="dropdown-item">Common</a>
</li>
                                    
<li>
    <a href="../../Git/" class="dropdown-item">Git</a>
</li>
                                    
<li>
    <a href="../../Gurobi/" class="dropdown-item">Gurobi</a>
</li>
                                    
<li>
    <a href="../../HDF/" class="dropdown-item">HDF</a>
</li>
                                    
<li>
    <a href="../../JSON/" class="dropdown-item">JSON</a>
</li>
                                    
<li>
    <a href="../../Native%20Libraries/" class="dropdown-item">Native Libraries</a>
</li>
                                    
<li>
    <a href="../../Perl/" class="dropdown-item">Perl</a>
</li>
                                    
<li>
    <a href="../../Regex/" class="dropdown-item">Regex</a>
</li>
                                    
<li>
    <a href="../../Ruby%20Workflow/" class="dropdown-item">Ruby Workflow</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">LaTeX <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../LaTeX/Latex%20manual/" class="dropdown-item">Latex manual</a>
</li>
                                    
<li>
    <a href="../../../LaTeX/LaTeX%20workflow/" class="dropdown-item">LaTeX workflow</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../../../Ubuntu" class="nav-link">Ubuntu</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Windows <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../Windows/Excel%20Manual/" class="dropdown-item">Excel Manual</a>
</li>
                                    
<li>
    <a href="../../../Windows/PowerPoint/" class="dropdown-item">PowerPoint</a>
</li>
                                    
<li>
    <a href="../../../Windows/Powershell%20Manual/" class="dropdown-item">Powershell Manual</a>
</li>
                                    
<li>
    <a href="../../../Windows/VSCode/" class="dropdown-item">VSCode</a>
</li>
                                    
<li>
    <a href="../../../Windows/Windows%20Manual/" class="dropdown-item">Windows Manual</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Audio & Video <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../Audio%20%26%20Video/FFMpeg/" class="dropdown-item">FFMpeg</a>
</li>
                                    
<li>
    <a href="../../../Audio%20%26%20Video/VLC/" class="dropdown-item">VLC</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Cloud computing <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../Cloud%20computing/Lmod/" class="dropdown-item">Lmod</a>
</li>
                                    
<li>
    <a href="../../../Cloud%20computing/RCI%20cluster/" class="dropdown-item">RCI cluster</a>
</li>
                                    
<li>
    <a href="../../../Cloud%20computing/Slurm/" class="dropdown-item">Slurm</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">GIS <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../GIS/GIS%20formats/" class="dropdown-item">GIS formats</a>
</li>
                                    
<li>
    <a href="../../../GIS/Overpass%20Manual/" class="dropdown-item">Overpass Manual</a>
</li>
                                    
<li>
    <a href="../../../GIS/QGIS/" class="dropdown-item">QGIS</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Images <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../Images/Midjourney/" class="dropdown-item">Midjourney</a>
</li>
                                    
<li>
    <a href="../../../Images/Photopea/" class="dropdown-item">Photopea</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Linux <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../Linux/Linux%20Manual/" class="dropdown-item">Linux Manual</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../../../Arxiv/" class="nav-link">Arxiv</a>
                            </li>
                            <li class="navitem">
                                <a href="../../../Google%20office%20apps/" class="nav-link">Google office apps</a>
                            </li>
                            <li class="navitem">
                                <a href="../../.." class="nav-link">index</a>
                            </li>
                            <li class="navitem">
                                <a href="../../../Markdown/" class="nav-link">Markdown</a>
                            </li>
                            <li class="navitem">
                                <a href="../../../Network/" class="nav-link">Network</a>
                            </li>
                            <li class="navitem">
                                <a href="../../../Security/" class="nav-link">Security</a>
                            </li>
                            <li class="navitem">
                                <a href="../../../vscode/" class="nav-link">vscode</a>
                            </li>
                            <li class="navitem">
                                <a href="../../../Web%20Tricks/" class="nav-link">Web Tricks</a>
                            </li>
                            <li class="navitem">
                                <a href="../../../YAML/" class="nav-link">YAML</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../C%2B%2B%20Workflow/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../Google%20Test/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#introduction" class="nav-link">Introduction</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#generators" class="nav-link">Generators</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#the-cmake-command" class="nav-link">The cmake command</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#configuration-generating-build-scripts" class="nav-link">Configuration: Generating Build scripts</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#toolchain-file" class="nav-link">Toolchain file</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#other-usefull-arguments" class="nav-link">Other Usefull arguments</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#legacy-arguments" class="nav-link">Legacy arguments</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#building" class="nav-link">Building</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#specify-the-target" class="nav-link">Specify the target</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#specify-the-build-type-debug-release" class="nav-link">Specify the build type (Debug, Release)</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#single-configuration-systems" class="nav-link">Single-configuration systems</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#multi-configuration-systems" class="nav-link">Multi-configuration systems</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#clean-the-source-files" class="nav-link">Clean the source files</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#install" class="nav-link">Install</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#cmake-command-line-tools" class="nav-link">CMake command-line tools</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#copy-tool" class="nav-link">Copy tool</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#syntax" class="nav-link">Syntax</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#variables" class="nav-link">Variables</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#variable-types" class="nav-link">Variable types</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#the-option-command" class="nav-link">The option command</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#enviromental-variables" class="nav-link">Enviromental variables</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#built-in-variables" class="nav-link">Built-in variables</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#list-variables" class="nav-link">List variables</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#print-all-variables" class="nav-link">Print all variables</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#control-structures" class="nav-link">Control structures</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#if" class="nav-link">if</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#foreach" class="nav-link">foreach</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#generator-expressions" class="nav-link">Generator expressions</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#evaluating-generator-expressions-during-configuration" class="nav-link">Evaluating generator expressions during configuration</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#file-operations" class="nav-link">File operations</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#path-operations" class="nav-link">Path operations</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#path-decomposition" class="nav-link">Path decomposition</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#list-operations" class="nav-link">List operations</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#functions" class="nav-link">Functions</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#named-arguments" class="nav-link">Named arguments</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#default-values-for-arguments" class="nav-link">Default values for arguments</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#return-values" class="nav-link">Return values</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#useful-functions" class="nav-link">Useful functions</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#message" class="nav-link">message</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#find_program" class="nav-link">find_program</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#cmakeliststxt" class="nav-link">CMakeLists.txt</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#typical-top-section-content" class="nav-link">Typical Top section content</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#language-standards" class="nav-link">Language standards</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#set-the-runtime-library-type-for-msvc" class="nav-link">Set the runtime library type for MSVC</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#compile-options" class="nav-link">Compile options</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="4"><a href="#msvc" class="nav-link">MSVC</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="4"><a href="#gcc" class="nav-link">GCC</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#linker-options" class="nav-link">Linker Options</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#dependency-management" class="nav-link">Dependency management</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#standard-way-find_package" class="nav-link">Standard way: find_package</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="4"><a href="#config-mode" class="nav-link">Config mode</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="4"><a href="#module-mode" class="nav-link">Module mode</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#searching-for-include-directories-with-find_path" class="nav-link">Searching for include directories with find_path</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#low-level-command-find_library" class="nav-link">Low level command: find_library</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="4"><a href="#searching-for-libraries-in-the-project-dir" class="nav-link">Searching for libraries in the project dir</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#creating-a-custom-find-script" class="nav-link">Creating a custom find script</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#downolad-dependencies-during-configuration-and-build-them-from-source" class="nav-link">Downolad dependencies during configuration and build them from source</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#cmake-targets" class="nav-link">CMake Targets</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#executable-targets" class="nav-link">Executable targets</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#library-targets" class="nav-link">Library targets</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#targets-automatically-generated-by-cmake" class="nav-link">Targets automatically generated by CMake</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#set-properties-for-a-target" class="nav-link">Set properties for a target</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#include-directories" class="nav-link">Include directories</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#inspect-the-include-directories" class="nav-link">Inspect the Include directories</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#linking-configuration" class="nav-link">Linking configuration</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#checking-the-full-path-to-a-linked-library" class="nav-link">Checking the full path to a linked library</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#handling-runtime-dependencies-in-the-output-directory" class="nav-link">Handling runtime dependencies in the output directory</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#copying-runtime-dependencies-using-add_custom_command" class="nav-link">Copying runtime dependencies using add_custom_command</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#runtime-dependencies-and-subdirectories" class="nav-link">Runtime dependencies and subdirectories</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#installation-configuration" class="nav-link">Installation Configuration</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#install-cmake-files" class="nav-link">Install CMake files</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="4"><a href="#installing-the-targets-file" class="nav-link">Installing the Targets file</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="4"><a href="#installing-the-package-configuration-file-and-the-version-file" class="nav-link">Installing the package configuration file and the version file</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="4"><a href="#sanitation-of-the-public-include-directories" class="nav-link">Sanitation of the public include directories</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="4"><a href="#handling-dependencies" class="nav-link">Handling dependencies</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#specify-the-targets-to-install" class="nav-link">Specify the targets to install</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="4"><a href="#selecting-the-targets-to-build-using-the-exclude_from_all-property" class="nav-link">Selecting the targets to build using the EXCLUDE_FROM_ALL property</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="4"><a href="#disabling-the-building-of-the-install-target-and-using-a-custom-wrapper-target" class="nav-link">Disabling the building of the install target and using a custom wrapper target</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#support-both-shared-and-static-libraries" class="nav-link">Support both shared and static libraries</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#support-both-debug-and-release-builds" class="nav-link">Support both Debug and Release builds</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#installation-of-executables" class="nav-link">Installation of executables</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#specific-configuration-for-frequentlly-used-libraries" class="nav-link">Specific configuration for frequentlly used libraries</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#for-windows-prevent-overriding-the-parent-projects-compilerlinker-settings" class="nav-link">For Windows: Prevent overriding the parent project's compiler/linker settings</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#multiple-cmakeliststxt-files-in-subdirectories" class="nav-link">Multiple CMakeLists.txt files in subdirectories</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#variables-scope" class="nav-link">Variables scope</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#decide-based-on-the-build-configuration" class="nav-link">Decide based on the build configuration</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#executing-external-commands" class="nav-link">Executing external commands</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#cmake-cache" class="nav-link">CMake Cache</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#cmake-directory-structure" class="nav-link">CMake Directory Structure</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#system-find_xxxcmake-files" class="nav-link">System Find_XXX.cmake files</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#various-tasks" class="nav-link">Various Tasks</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#showing-the-generator-for-a-configured-directory" class="nav-link">Showing the generator for a configured directory</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#display-available-generators" class="nav-link">Display available generators</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#determine-the-binary-output-directory" class="nav-link">Determine the binary output directory</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#debugging-cmake" class="nav-link">Debugging CMake</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#debugging-cmake-using-clion-cmake-debugger" class="nav-link">Debugging CMake using CLion CMake debugger</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#getting-a-a-complete-output-of-the-cmake-configuration" class="nav-link">Getting a a complete output of the CMake configuration</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#testing-with-cmake" class="nav-link">Testing with CMake</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#adding-tests" class="nav-link">Adding tests</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#ctest-execution" class="nav-link">CTest execution</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#run-tests-mode-default" class="nav-link">Run Tests mode (default)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#build-and-test-mode" class="nav-link">Build and Test mode</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#dashboard-mode" class="nav-link">Dashboard mode</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="4"><a href="#using-the-dashboard-mode-configured-by-the-script" class="nav-link">Using the Dashboard mode configured by the script</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="4"><a href="#configuring-the-dashboard" class="nav-link">Configuring the Dashboard</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#problems" class="nav-link">Problems</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="4"><a href="#warning-name-library-version-mismatched-error" class="nav-link">Warning! &lt;name&gt; library version mismatched error</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#test-fixtures" class="nav-link">Test fixtures</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#running-tests-not-related-to-any-cmake-project" class="nav-link">Running tests not related to any CMake project</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h1>
<p>CMake is </p>
<ul>
<li>a cross-platform build system generator that generates build scripts for various build systems (e.g., make, ninja, Visual Studio, Xcode)</li>
<li>a name of the language used to write the configuration files for the build system generator and other related scripts.</li>
</ul>
<p>CMake can run in two modes:</p>
<ul>
<li><strong>project mode</strong>: is the standard mode. This mode is used when the project is configured using the <code>cmake</code> command. Therefore, the <code>CMakeLists.txt</code> file is executed in this mode.</li>
<li><strong>script mode</strong>: is used when the <code>cmake</code> command is run with the <code>-P</code> option. In this mode, the <code>CMakeLists.txt</code> file is not executed, but the script specified by the <code>-P</code> option is executed.</li>
</ul>
<p>Main resources:</p>
<ul>
<li><a href="https://cmake.org/cmake/help/latest/index.html">CMake documentation</a></li>
<li><a href="https://cmake.org/cmake/help/latest/guide/tutorial/index.html">CMake tutorial</a></li>
</ul>
<h2 id="generators">Generators<a class="headerlink" href="#generators" title="Permanent link">&para;</a></h2>
<p>CMake not only supports multiple platforms but also multiple build systems on each platform. These build systems are called <em>generators</em>. To get a list of available generators, run:</p>
<pre><code class="language-bash">cmake -E capabilities
</code></pre>
<h1 id="the-cmake-command">The <code>cmake</code> command<a class="headerlink" href="#the-cmake-command" title="Permanent link">&para;</a></h1>
<p><a href="https://cmake.org/cmake/help/latest/manual/cmake.1.html">documentation</a></p>
<h2 id="configuration-generating-build-scripts">Configuration: Generating Build scripts<a class="headerlink" href="#configuration-generating-build-scripts" title="Permanent link">&para;</a></h2>
<p>General syntax is:</p>
<pre><code class="language-bash">cmake &lt;source dir&gt;
</code></pre>
<p>Here <code>&lt;source dir&gt;</code> is the <code>CMakeLists.txt</code> directory. The build scripts are build in current directory.</p>
<p>We can set any cache variable using the <code>-D</code> argument. Example:</p>
<pre><code class="language-bash">cmake &lt;source dir&gt; -D &lt;variable name&gt;=&lt;variable value&gt;
# or equivalently
cmake &lt;source dir&gt; -D&lt;variable name&gt;=&lt;variable value&gt;
</code></pre>
<h3 id="toolchain-file">Toolchain file<a class="headerlink" href="#toolchain-file" title="Permanent link">&para;</a></h3>
<p>To work with package managers, a link to toolchain file has to be provided as an argument. For <code>vcpkg</code>, the argument is as follows:</p>
<pre><code class="language-bash"># new version
cmake &lt;dir&gt; --toolchain &lt;vcpkg location&gt;/scripts/buildsystems/vcpkg.cmake

# old version
cmake &lt;dir&gt; -DCMAKE_TOOLCHAIN_FILE=&lt;vcpkg location&gt;/scripts/buildsystems/vcpkg.cmake
</code></pre>
<p>Note that the toolchain is only loaded at the beginnning of the generation process. Once you forgot it, <strong>you need to delete the build scripts diectory content to make this argument work</strong> for subsequent cmake commands.</p>
<h3 id="other-usefull-arguments">Other Usefull arguments<a class="headerlink" href="#other-usefull-arguments" title="Permanent link">&para;</a></h3>
<ul>
<li><code>-B &lt;build dir&gt;</code> to specify the build directory. By default, the build directory is the current directory.</li>
<li><code>-LH</code> to see cmake nonadvanced variables together with the description. </li>
<li><code>-LHA</code> to see also the advanced variables. Note that this prints only cached variables, to print all variables, we have to edit the CmakeLists.txt.</li>
</ul>
<h3 id="legacy-arguments">Legacy arguments<a class="headerlink" href="#legacy-arguments" title="Permanent link">&para;</a></h3>
<ul>
<li><code>-H</code>: to specify the source directory (where the <code>CMakeLists.txt</code> file is located). Now it is specified as the positional argument or using <code>-S</code>.</li>
</ul>
<h2 id="building">Building<a class="headerlink" href="#building" title="Permanent link">&para;</a></h2>
<p>For building, use:</p>
<pre><code class="language-bash">cmake --build &lt;build dir&gt;
</code></pre>
<p>where build dir is the directory containing the build scripts (<code>CmakeFiles</code> folder).</p>
<p>To list the build options:</p>
<pre><code>cmake -L
</code></pre>
<h3 id="specify-the-target">Specify the target<a class="headerlink" href="#specify-the-target" title="Permanent link">&para;</a></h3>
<p>By default, all targets are built. We can use the <code>--target</code> to specify a single target:</p>
<pre><code class="language-cmake">cmake --build . --target &lt;TARGET NAME&gt;
</code></pre>
<p>There is also a special target <code>all</code> that builds all targets, which is equivalent to not specifying the <code>--target</code> argument.</p>
<h2 id="specify-the-build-type-debug-release">Specify the build type (Debug, Release)<a class="headerlink" href="#specify-the-build-type-debug-release" title="Permanent link">&para;</a></h2>
<p>In CMake, we use a specific build type string instead of compiler and linker flags:</p>
<ul>
<li><code>Debug</code> - Debug build</li>
<li><code>Release</code> - Release build</li>
<li><code>RelWithDebInfo</code> - Release build with debug information</li>
<li><code>MinSizeRel</code> - Release build with minimal size</li>
</ul>
<p>Unfortunately, the way how the build type should be specified depends on the build system:</p>
<ul>
<li><strong>Single-configuration systems</strong> (GCC, Clang, MinGW) </li>
<li><strong>Multi-configuration systems</strong> (MSVC)</li>
</ul>
<h3 id="single-configuration-systems">Single-configuration systems<a class="headerlink" href="#single-configuration-systems" title="Permanent link">&para;</a></h3>
<p>Single configuration systems have the compiler flags hardcoded in the build scripts. Therefore, we need to specify the build type for CMake when we generate the build scripts:</p>
<pre><code class="language-bash">cmake ../ -DCMAKE_BUILD_TYPE=Release
</code></pre>
<p><strong>By default, the build type is an empty string</strong>. This means that no extra flags are added to the compiler and linker so the compiler and linker run with their default settings.</p>
<p>Interesting info can be found in <a href="https://stackoverflow.com/questions/48754619/what-are-cmake-build-type-debug-release-relwithdebinfo-and-minsizerel">this SO question</a>.</p>
<h3 id="multi-configuration-systems">Multi-configuration systems<a class="headerlink" href="#multi-configuration-systems" title="Permanent link">&para;</a></h3>
<p>In multi-configuration systems, the <code>-DCMAKE_BUILD_TYPE</code> parameter is ignored, because the build configuration is supposed to be determined when building the code (i.e., same build scripts for debug and for release). Therefore, we omit it, and instead specify the <code>--config</code> parameter when building the code:</p>
<pre><code class="language-bash">cmake --build . --config Release
</code></pre>
<h2 id="clean-the-source-files">Clean the source files<a class="headerlink" href="#clean-the-source-files" title="Permanent link">&para;</a></h2>
<p>Run:</p>
<pre><code>cmake --build . --target clean
</code></pre>
<h2 id="install">Install<a class="headerlink" href="#install" title="Permanent link">&para;</a></h2>
<p>To be able to install the project, it needs to be configured to do so. For this, check the <a href="#installation-configuration">installation configuration</a>.</p>
<p>To install the project, run:</p>
<pre><code class="language-bash">cmake --install &lt;build dir&gt;
</code></pre>
<p>Note that the project needs to be built first. If it is not, we can build and install in one step using the <code>--build</code> with the <code>--target install</code> argument:</p>
<pre><code class="language-bash">cmake --build &lt;build dir&gt; --target install
</code></pre>
<p>Usually, we want to use a different directory when testing the installation. To do that, we need to configure the project with the <code>CMAKE_INSTALL_PREFIX</code> variable. Example:</p>
<pre><code class="language-bash">cmake -DCMAKE_INSTALL_PREFIX=&lt;test install dir&gt; &lt;source dir&gt;
</code></pre>
<p><strong>A note for Windows installations</strong>: The default <code>CMAKE_INSTALL_PREFIX</code> is <code>C:/Program Files (x86)/&lt;project name&gt;</code>, even if the project is a 64-bit project. To override this, configure the project with the following argument:</p>
<pre><code class="language-bash">cmake &lt;other arguments&gt; -A x64
</code></pre>
<h2 id="cmake-command-line-tools">CMake command-line tools<a class="headerlink" href="#cmake-command-line-tools" title="Permanent link">&para;</a></h2>
<p><a href="https://cmake.org/cmake/help/latest/manual/cmake.1.html#run-a-command-line-tool">documentation</a></p>
<p>Apart from standard commands listed in previous sections, CMake provides several command-line tools that are not directly related to the build process. These tools wrap the system commands so that we are able to use them in a cross-platform way. To run these tools, execute:</p>
<pre><code class="language-bash">cmake -E &lt;tool name&gt; &lt;arguments&gt;
</code></pre>
<p>The most useful tools are:</p>
<ul>
<li><code>copy</code> - copy files and directories</li>
<li><code>capabilities</code> - print the properties of the system related to the build process</li>
</ul>
<h3 id="copy-tool">Copy tool<a class="headerlink" href="#copy-tool" title="Permanent link">&para;</a></h3>
<p>The copy tool has two signatures:</p>
<ul>
<li><code>copy &lt;source&gt; &lt;destination&gt;</code> </li>
<li><code>copy -t &lt;destination&gt; &lt;source&gt;</code> (<strong>only available in CMake 3.26 and later</strong>)</li>
</ul>
<p>Here, <code>&lt;source&gt;</code> can be a directory, a file, or a list of files. The <code>&lt;destination&gt;</code> can be a directory or a file. </p>
<h1 id="syntax">Syntax<a class="headerlink" href="#syntax" title="Permanent link">&para;</a></h1>
<h2 id="variables">Variables<a class="headerlink" href="#variables" title="Permanent link">&para;</a></h2>
<p>In order to use a variable in the <code>CMakeLists.txt</code> file, we have to use the <code>${}</code> syntax:</p>
<pre><code class="language-cmake">message(STATUS &quot;dir=${dir}&quot;)
</code></pre>
<p>In conditions, we can use the variable using its name:</p>
<pre><code class="language-cmake">if(DEFINED &lt;name&gt;)
...
</code></pre>
<p>Variables are set using the <a href="https://cmake.org/cmake/help/latest/command/set.html"><code>set</code></a> command:</p>
<pre><code class="language-cmake">set(&lt;variable name&gt; &lt;variable value&gt;)
</code></pre>
<h3 id="variable-types">Variable types<a class="headerlink" href="#variable-types" title="Permanent link">&para;</a></h3>
<p>CMake has two types of variables:</p>
<ul>
<li><strong>string variables</strong>: the most common type of variable. A string variable is created if the <code>&lt;variable value&gt;</code> is a single word or a quoted string. Example:
    <code>cmake
    set(dir "C:/Program Files")</code></li>
<li><strong>list variables</strong>: a list variable is created if the <code>&lt;variable value&gt;</code> is a list of words. Example:
    <code>cmake
    set(dirs "C:/Program Files" "C:/Program Files (x86)")</code></li>
</ul>
<h2 id="the-option-command">The <code>option</code> command<a class="headerlink" href="#the-option-command" title="Permanent link">&para;</a></h2>
<p>The <a href="https://cmake.org/cmake/help/latest/command/option.html"><code>option</code></a> command is used to define a <strong>boolean</strong> variable that can:</p>
<ul>
<li>be set by the user using the <code>-D</code> argument when running the <code>cmake</code> command,</li>
<li>have a default value,</li>
<li>have a description that will be printed when the variable is set, and</li>
<li>set a cache variable (see <a href="#cmake-cache">CMake cache</a>).</li>
</ul>
<p>The syntax is:</p>
<pre><code class="language-cmake">option(&lt;option name&gt; &lt;option description&gt; &lt;default value&gt;)
</code></pre>
<p>The behavior of the <code>option</code> command is as follows:</p>
<ul>
<li>If variable is already set (either a cache variable or a normal variable), the <code>option</code> command is ignored.</li>
<li>Otherwise, a cache variable is created if we are in the project mode, and a normal variable is created if we are in the script mode.</li>
</ul>
<h3 id="enviromental-variables">Enviromental variables<a class="headerlink" href="#enviromental-variables" title="Permanent link">&para;</a></h3>
<p>We can use environmental variables using the <code>ENV</code> variable:</p>
<pre><code class="language-cmake">if(DEFINED ENV{&lt;name&gt;})
...
</code></pre>
<p>Be aware that in string, we use only one pair of curly braces (see <a href="https://cmake.org/cmake/help/latest/manual/cmake-language.7.html#variable-references">variable references manual</a>):</p>
<pre><code class="language-cmake">message(STATUS &quot;dir=$ENV{dir}&quot;)
</code></pre>
<h3 id="built-in-variables">Built-in variables<a class="headerlink" href="#built-in-variables" title="Permanent link">&para;</a></h3>
<p><a href="https://cmake.org/cmake/help/latest/manual/cmake-variables.7.html">documentation</a></p>
<p>There are some variable generated by default by CMake when run in the <em>config</em> mode. The most usefule are:</p>
<ul>
<li><code>CMAKE_CURRENT_SOURCE_DIR</code>: the directory where the currently processed <code>CMakeLists.txt</code> file is located.</li>
<li><a href="https://cmake.org/cmake/help/latest/variable/CMAKE_CURRENT_BINARY_DIR.html"><code>CMAKE_CURRENT_BINARY_DIR</code></a>: the directory where the build scripts are located and where the build process is executed. For some generators, this is also the directory where the binaries are stored.</li>
<li><a href="https://cmake.org/cmake/help/latest/variable/CMAKE_CURRENT_LIST_DIR.html"><code>CMAKE_CURRENT_LIST_DIR</code></a>: the directory where the currently processed <code>CMakeLists.txt</code> file is located.</li>
<li><a href="https://cmake.org/cmake/help/latest/variable/PROJECT_SOURCE_DIR.html"><code>PROJECT_SOURCE_DIR</code></a>: the nearest directory up in the directory tree where the <code>CMakeLists.txt</code> with the <code>project</code> command is located.</li>
<li><a href="https://cmake.org/cmake/help/latest/variable/CMAKE_LANG_COMPILER_ID.html"><code>CMAKE_&lt;LANG&gt;_COMPILER_ID</code></a>: the compiler ID for the language <code>&lt;LANG&gt;</code>.</li>
<li><a href="https://cmake.org/cmake/help/latest/variable/CMAKE_LANG_COMPILER_VERSION.html"><code>CMAKE_&lt;LANG&gt;_COMPILER_VERSION</code></a>: the compiler version for the language <code>&lt;LANG&gt;</code>.</li>
</ul>
<p>In the <em>script</em> mode, there are fewer variables available. To get <strong>the current working directory</strong>, we can use any of the following variables:</p>
<ul>
<li><code>CMAKE_SOURCE_DIR</code></li>
<li><code>CMAKE_CURRENT_SOURCE_DIR</code></li>
<li><code>CMAKE_BINARY_DIR</code></li>
<li><code>CMAKE_CURRENT_BINARY_DIR</code></li>
</ul>
<p>Other useful variables for the script mode are:</p>
<ul>
<li><code>CMAKE_CURRENT_LIST_DIR</code>: the directory where the currently processed script is located</li>
</ul>
<p>There are also variables for installation directories typical for Unix systems. Touse them, we have to include the <a href="https://cmake.org/cmake/help/latest/module/GNUInstallDirs.html"><code>GNUInstallDirs</code> module</a>. The variables have two formats:</p>
<ul>
<li><code>CMAKE_INSTALL_&lt;dir&gt;</code>: the directory relative to the installation prefix. These variables have to be used in the <code>install</code> command and other commands that use the installation prefix.</li>
<li><code>CMAKE_INSTALL_FULL_&lt;dir&gt;</code>: the full path to the directory. </li>
</ul>
<p>Notable variables are:</p>
<ul>
<li><code>BINDIR</code>: the directory for executables (<code>bin</code>)</li>
<li><code>LIBDIR</code>: the directory for libraries (<code>lib</code>)</li>
<li><code>INCLUDEDIR</code>: the directory for headers (<code>include</code>)</li>
</ul>
<h3 id="list-variables">List variables<a class="headerlink" href="#list-variables" title="Permanent link">&para;</a></h3>
<p>List variables are defined similarly to scalar variables using the <code>set</code> command:</p>
<pre><code class="language-cmake">set(&lt;name&gt; &lt;value 1&gt; &lt;value 2&gt; ...)
</code></pre>
<p>Then, we can use the list variable in:</p>
<ul>
<li>commands that accept lists (e.g., <code>add_executable</code>, <code>add_library</code>, <code>target_link_libraries</code>)</li>
<li>for loops</li>
</ul>
<h3 id="print-all-variables">Print all variables<a class="headerlink" href="#print-all-variables" title="Permanent link">&para;</a></h3>
<p>To print all variables, the following function can be used:</p>
<pre><code class="language-cmake">function(dump_cmake_variables)
    if (ARGV0)
        message(STATUS &quot;Printing variables matching '${ARGV0}'&quot;)
    else()
        message(STATUS &quot;Printing all variables&quot;)
    endif()
    get_cmake_property(_variableNames VARIABLES)
    list (SORT _variableNames)
    foreach (_variableName ${_variableNames})
        if (ARGV0)
            unset(MATCHED)
            string(REGEX MATCH ${ARGV0} MATCHED ${_variableName})
            if (NOT MATCHED)
                continue()
            endif()
        endif()
        message(STATUS &quot;${_variableName}=${${_variableName}}&quot;)
    endforeach()
    message(STATUS &quot;Printing variables - END&quot;)
endfunction()
</code></pre>
<p>To print all variables related to HDF5 lib, call <code>dump_cmake_variables(HDF)</code> after the <code>find_package</code> call.</p>
<h2 id="control-structures">Control structures<a class="headerlink" href="#control-structures" title="Permanent link">&para;</a></h2>
<h3 id="if"><code>if</code><a class="headerlink" href="#if" title="Permanent link">&para;</a></h3>
<p>The <a href="https://cmake.org/cmake/help/latest/command/if.html"><code>if</code></a> command has the following syntax:</p>
<pre><code class="language-cmake">if(&lt;condition&gt;)
...
elseif(&lt;condition&gt;)
...
else()
...
endif()
</code></pre>
<p>The condition can be:</p>
<ul>
<li>a variable</li>
<li>an expression</li>
</ul>
<p>Each expression can use some of the supported operators:</p>
<ul>
<li>logical operators: <code>AND</code>, <code>OR</code>, <code>NOT</code></li>
<li>comparison operators: <code>EQUAL</code>, <code>LESS</code>, <code>GREATER</code>, <code>LESS_EQUAL</code>, <code>GREATER_EQUAL</code>, <code>STREQUAL</code>, <code>STRLESS</code>, <code>STRGREATER</code>, <code>STRLESS_EQUAL</code>, <code>STRGREATER_EQUAL</code></li>
<li>file operators: <code>EXISTS</code>, <code>IS_DIRECTORY</code>, <code>IS_REGULAR_FILE</code>, <code>IS_SYMLINK</code>, <code>IS_ABSOLUTE</code>, <code>IS_RELATIVE</code>, <code>IS_NEWER_THAN</code>, <code>IS_OLDER_THAN</code></li>
<li>string operators: <code>MATCHES</code>, <code>LESS</code>, <code>GREATER</code>, <code>LESS_EQUAL</code>, <code>GREATER_EQUAL</code>, <code>STREQUAL</code>, <code>STRLESS</code>, <code>STRGREATER</code>, <code>STRLESS_EQUAL</code>, <code>STRGREATER_EQUAL</code><ul>
<li>The <code>MATCHES</code> operator requires a regex, not a simplified filesystem filter pattern. See the <a href="https://cmake.org/cmake/help/latest/command/string.html#regex-specification">regex documentation</a> for more.</li>
</ul>
</li>
<li>
<p>version operators: <code>VERSION_EQUAL</code>, <code>VERSION_LESS</code>, <code>VERSION_GREATER</code>, <code>VERSION_LESS_EQUAL</code>, <code>VERSION_GREATER_EQUAL</code></p>
<ul>
<li>these are ment to be used with version string variables created by the <code>find_package</code> command:</li>
</ul>
<p><code>cmake
find_package(&lt;package name&gt; CONFIG REQUIRED)
if(&lt;package name&gt;_VERSION VERSION_LESS &lt;version&gt;)
...
endif()</code></p>
</li>
<li>
<p>and more...</p>
</li>
</ul>
<p>For the full list of operators, see the <a href="https://cmake.org/cmake/help/latest/command/if.html">if command documentation</a>.</p>
<h3 id="foreach"><code>foreach</code><a class="headerlink" href="#foreach" title="Permanent link">&para;</a></h3>
<p>The <a href="https://cmake.org/cmake/help/latest/command/foreach.html"><code>foreach</code></a> command has the following syntax:</p>
<pre><code class="language-cmake">foreach(&lt;variable name&gt; &lt;items&gt;)
...
endforeach()
</code></pre>
<h2 id="generator-expressions">Generator expressions<a class="headerlink" href="#generator-expressions" title="Permanent link">&para;</a></h2>
<p><a href="https://cmake.org/cmake/help/latest/manual/cmake-generator-expressions.7.html"><code>Manual</code></a></p>
<p>Generator expressions are a very useful tool to control the build process based on the build type, compiler type, or similar properties. CMake use them to generate mutliple build scripts from a single <code>CMakeLists.txt</code> file.</p>
<p>The syntax for a basic condition expression is:</p>
<pre><code class="language-cmake">&quot;$&lt;$&lt;condition&gt;:&lt;this will be printed if condition is satisfied&gt;&gt;&quot;
</code></pre>
<p>Unlike, variables, the <strong>generator expressions are evaluated during the build process, not during the configuration process</strong>. Therefore, they cannot be dumped during the configuration process, and they cannot be used in the <code>if</code> command. However, they can be still used in variables and commands, if the evaluation is not needed during the configuration process.</p>
<p>Notable variable expressions:</p>
<ul>
<li><code>$&lt;TARGET_FILE_DIR:&lt;target name&gt;&gt;</code> - the directory where the target will be built</li>
<li><a href="https://cmake.org/cmake/help/latest/manual/cmake-generator-expressions.7.html#genex:TARGET_RUNTIME_DLLS"><code>$&lt;TARGET_RUNTIME_DLLS:&lt;target name&gt;&gt;</code></a> - the list of runtime dependencies of the target<ul>
<li>note that this property is only available (and necessary) for MSBuild generator and it is only available in the <code>POST_BUILD</code> phase.</li>
</ul>
</li>
</ul>
<h3 id="evaluating-generator-expressions-during-configuration">Evaluating generator expressions during configuration<a class="headerlink" href="#evaluating-generator-expressions-during-configuration" title="Permanent link">&para;</a></h3>
<p>In case we need to see the evaluated generator expressions during cmake configuration, we can try to cheat using the following command:</p>
<pre><code class="language-cmake">file(GENERATE OUTPUT &lt;filename&gt; CONTENT &lt;string-with-generator-expression&gt;)
</code></pre>
<p>This way, we receive the evaluated value of the generator expression in the file for one of the build configurations.</p>
<h2 id="file-operations">File operations<a class="headerlink" href="#file-operations" title="Permanent link">&para;</a></h2>
<p>To perform file operations, use the <a href="https://cmake.org/cmake/help/latest/command/file.html"><code>file</code></a> command. The most useful subcommands are:</p>
<ul>
<li><code>MAKE_DIRECTORY &lt;directory&gt;</code> - create a directory</li>
<li><code>RENAME &lt;from&gt; &lt;to&gt;</code> - renames/moves a file or directory. The <code>&lt;from&gt;</code> must exist, and the parent directory of <code>&lt;to&gt;</code> must exist. </li>
<li><code>REMOVE &lt;file&gt;</code> - remove a file </li>
<li><code>REMOVE_RECURSE &lt;directory&gt;</code> - remove a directory and all its content</li>
</ul>
<h2 id="path-operations">Path operations<a class="headerlink" href="#path-operations" title="Permanent link">&para;</a></h2>
<p>Path operations are performed using the <a href="https://cmake.org/cmake/help/latest/command/cmake_path.html"><code>cmake_path</code></a> command. The sytax for this command varies based on the subcommand.</p>
<h3 id="path-decomposition">Path decomposition<a class="headerlink" href="#path-decomposition" title="Permanent link">&para;</a></h3>
<p>The syntax for the path decomposition is:</p>
<pre><code class="language-cmake">cmake_path(GET &lt;path&gt; &lt;path part&gt; &lt;output variable&gt;)
</code></pre>
<p>Here, <code>&lt;path part&gt;</code> can be:</p>
<ul>
<li><code>PARENT_PATH</code> - the parent directory of the path</li>
</ul>
<h2 id="list-operations">List operations<a class="headerlink" href="#list-operations" title="Permanent link">&para;</a></h2>
<p>For list operations, use the <a href="https://cmake.org/cmake/help/latest/command/list.html"><code>list</code></a> command. The most useful subcommands are:</p>
<ul>
<li><a href="https://cmake.org/cmake/help/latest/command/list.html#append"><code>APPEND</code></a> - append an element to the list: <code>list(APPEND &lt;list name&gt; &lt;elements&gt;)</code></li>
<li><a href="https://cmake.org/cmake/help/latest/command/list.html#join"><code>JOIN</code></a> - join the list elements into a string: <code>list(JOIN &lt;list name&gt; &lt;separator&gt; &lt;output variable&gt;)</code></li>
</ul>
<h2 id="functions">Functions<a class="headerlink" href="#functions" title="Permanent link">&para;</a></h2>
<p>Functions are defined using the <a href="https://cmake.org/cmake/help/latest/command/function.html"><code>function</code></a> command. The syntax is:</p>
<pre><code class="language-cmake">function(&lt;function name&gt; &lt;argument 1&gt; &lt;argument 2&gt; ...)
...
endfunction()
</code></pre>
<p>This way, we have a function with simple positional arguments. These arguments can be used in the function body as variables:</p>
<pre><code class="language-cmake">function(print_arguments arg1 arg2)
    message(STATUS &quot;arg1=${arg1}&quot;)
    message(STATUS &quot;arg2=${arg2}&quot;)
endfunction()
</code></pre>
<p>To call the function, use the following syntax:</p>
<pre><code class="language-cmake">print_arguments(&quot;value 1&quot; &quot;value 2&quot;)
</code></pre>
<p>More resources:</p>
<ul>
<li>https://hsf-training.github.io/hsf-training-cmake-webpage/11-functions/index.html</li>
</ul>
<h3 id="named-arguments">Named arguments<a class="headerlink" href="#named-arguments" title="Permanent link">&para;</a></h3>
<p>We can notice that a typical cmake function has named arguments, e.g., <code>add_custom_command(TARGET &lt;target name&gt; POST_BUILD COMMAND &lt;command&gt;)</code>. To achieve this, we can use the <a href="https://cmake.org/cmake/help/latest/command/cmake_parse_arguments.html"><code>cmake_parse_arguments</code></a> command. The syntax is:</p>
<pre><code class="language-cmake">function(&lt;function name&gt;)
    cmake_parse_arguments(
        PARSE_ARGV &lt;positional args count&gt; 
        &lt;variable prefix&gt; 
        &lt;options&gt;
        &lt;one_value_keywords&gt; 
        &lt;multi_value_keywords&gt;
    )
</code></pre>
<p>Here:</p>
<ul>
<li><code>&lt;positional args count&gt;</code> is the number of positional arguments that are skipped by the <code>cmake_parse_arguments</code> command,</li>
<li><code>&lt;variable prefix&gt;</code> is the prefix for variables created from named arguments (the name will be <code>&lt;variable prefix&gt;_&lt;variable_name&gt;</code>),</li>
<li>and <code>&lt;options&gt;</code>, <code>&lt;one_value_keywords&gt;</code>, and <code>&lt;multi_value_keywords&gt;</code> are the lists of named arguments of each type.<ul>
<li>the list have to be specified as a string divided by a semicolon.</li>
<li>The <code>&lt;options&gt;</code> are the arguments that can be either present or not, the <code>&lt;one_value_keywords&gt;</code> are the arguments that have a single value, and the <code>&lt;multi_value_keywords&gt;</code> are the arguments that have multiple values.</li>
</ul>
</li>
</ul>
<h3 id="default-values-for-arguments">Default values for arguments<a class="headerlink" href="#default-values-for-arguments" title="Permanent link">&para;</a></h3>
<p>There is no specific syntax for default values for arguments. We can achieve this, for example, by using the <code>if</code> command:</p>
<pre><code class="language-cmake">if(NOT DEFINED &lt;variable&gt;)
    set(&lt;variable&gt; &lt;default value&gt;)
endif()
</code></pre>
<h3 id="return-values">Return values<a class="headerlink" href="#return-values" title="Permanent link">&para;</a></h3>
<p>There is a <a href="https://cmake.org/cmake/help/latest/command/return.html">return statement</a> in CMake, but in general, the value is returned by setting a variable with a parent scope:</p>
<pre><code class="language-cmake">function(return_value)
    set(&lt;return val name&gt; &lt;value&gt; PARENT_SCOPE)
endfunction()
</code></pre>
<p>If we want to determine the return variable name by the caller, we have to pass the variable name as an argument:</p>
<pre><code class="language-cmake">function(return_value return_var_name)
    set(${return_var_name} &lt;value&gt; PARENT_SCOPE)
endfunction()
</code></pre>
<h1 id="useful-functions">Useful functions<a class="headerlink" href="#useful-functions" title="Permanent link">&para;</a></h1>
<h2 id="message"><code>message</code><a class="headerlink" href="#message" title="Permanent link">&para;</a></h2>
<p>The <a href="https://cmake.org/cmake/help/latest/command/message.html"><code>message</code></a> command is used to print messages during the configuration process. The syntax is:</p>
<pre><code class="language-cmake">message(&lt;mode&gt; &lt;message&gt;)
</code></pre>
<p>The <code>&lt;mode&gt;</code> can be:</p>
<ul>
<li><code>STATUS</code> - the message is printed as a status message</li>
<li><code>WARNING</code> - the message is printed as a warning</li>
<li><code>AUTHOR_WARNING</code> - the message is printed as an author warning</li>
<li><code>SEND_ERROR</code> - the message is printed as an error and the configuration process is stopped</li>
<li><code>FATAL_ERROR</code> - the message is printed as a fatal error and the configuration process is stopped</li>
<li><code>DEPRECATION</code> - the message is printed as a deprecation warning</li>
</ul>
<h2 id="find_program"><code>find_program</code><a class="headerlink" href="#find_program" title="Permanent link">&para;</a></h2>
<p>The <a href="https://cmake.org/cmake/help/latest/command/find_program.html"><code>find_program</code></a> command is used to find an executable in the system. It's adventages over providing our own path/logic is:</p>
<ul>
<li>it is cross-platform - it automatically searches for the executable with the correct extension for the current platform</li>
<li>it can be configured to raise an error if the executable is not found</li>
<li>it can automatically search for the executable in the system paths</li>
</ul>
<p>The syntax is:</p>
<pre><code class="language-cmake">find_program(&lt;variable name&gt; &lt;executable name&gt; [OTHER_ARGUMENTS])
</code></pre>
<p>The full path to the executable is stored in the <code>&lt;variable name&gt;</code> variable. The <code>OTHER_ARGUMENTS</code> are:</p>
<ul>
<li><code>REQUIRED</code>: if the executable is not found, the configuration process is stopped</li>
<li><code>HINTS &lt;path&gt;</code>, <code>PATHS &lt;path&gt;</code>: the path where the executable should be searched. <code>HINTS</code> and <code>PATHS</code> are equivalent exept the priority: <code>HINTS</code> are searched before the standard paths, <code>PATHS</code> are searched at the end with the lowest priority.</li>
</ul>
<h1 id="cmakeliststxt">CMakeLists.txt<a class="headerlink" href="#cmakeliststxt" title="Permanent link">&para;</a></h1>
<p>The <code>CMakeLists.txt</code> file is the main configuration file for any CMake project. This file is executed during the <a href="#configuration-generating-build-scripts">configuration step</a> (when the <code>cmake</code> command is run without arguments specifying another step).
 It contains commands written in the CMake language that are used to configure the build process.</p>
<p>The typical structure of the <code>CMakeLists.txt</code> file is as follows:</p>
<ol>
<li>
<p>Top section contains project wide setting like name, minimum cmake version, and the language specification.</p>
</li>
<li>
<p>Targets sections containing:</p>
<ul>
<li>the target definition together with sources used</li>
<li>target includes</li>
<li>target linking</li>
</ul>
</li>
</ol>
<h2 id="typical-top-section-content">Typical Top section content<a class="headerlink" href="#typical-top-section-content" title="Permanent link">&para;</a></h2>
<p>The typical content of the top section is:</p>
<ul>
<li>minimum cmake version: <code>cmake_minimum_required(VERSION &lt;version&gt;)</code></li>
<li>project name and version: <code>project(&lt;name&gt; VERSION &lt;version&gt;)</code></li>
<li>language specification: <code>enable_language(&lt;language&gt;)</code></li>
<li>cmake variables setup, e.g.: <code>set(CMAKE_CXX_STANDARD &lt;version&gt;)</code></li>
<li>compile options: <code>add_compile_options(&lt;option 1&gt; &lt;option 2&gt; ...)</code></li>
<li>cmake module inclusion: <code>include(&lt;module name&gt;)</code></li>
</ul>
<h3 id="language-standards">Language standards<a class="headerlink" href="#language-standards" title="Permanent link">&para;</a></h3>
<p>The language standard is set using the <code>set</code> command together with the <code>CMAKE_&lt;LANG&gt;_STANDARD</code> variable. Example:</p>
<pre><code class="language-cmake">set(CMAKE_CXX_STANDARD 17)
</code></pre>
<p>This way, the standard is set for all targets and the compiler should be configured for that standard. However, if the compiler does not support the standard, the build script generation continues and the failure will appear later during the compilation. To avoid that, we can make the standard a requirement using the <code>set</code> command together with the <code>CMAKE_&lt;LANG&gt;_STANDARD_REQUIRED</code> variable. Example:</p>
<pre><code class="language-cmake">set(CMAKE_CXX_STANDARD_REQUIRED ON)
</code></pre>
<p>However, the required standard is not always correctly supported by the compiler (e.g., GCC up to version 13 does not support C++20). Therefore, we need to specify the minimum version for these compilers:</p>
<pre><code class="language-cmake">if(CMAKE_CXX_COMPILER_ID STREQUAL &quot;GNU&quot; AND CMAKE_CXX_COMPILER_VERSION VERSION_LESS 13.0.0)
    message(FATAL_ERROR &quot;GCC version must be at least 13.0.0!&quot;)
endif()
</code></pre>
<h3 id="set-the-runtime-library-type-for-msvc">Set the runtime library type for MSVC<a class="headerlink" href="#set-the-runtime-library-type-for-msvc" title="Permanent link">&para;</a></h3>
<p>In MSVC, it is crucial that both the target and all its dependencies are compiled with the same (standard) runtime library type. </p>
<p>To set the library type for the target in CMake, we use the <a href="https://cmake.org/cmake/help/latest/variable/CMAKE_MSVC_RUNTIME_LIBRARY.html"><code>CMKAE_MSVC_RUNTIME_LIBRARY</code></a> variable. The possible values are:</p>
<ul>
<li><code>MultiThreadedDLL</code> - the dynamic library (default in Release mode)</li>
<li><code>MultiThreadedDebugDLL</code> - the dynamic library with debug information (default in Debug mode)</li>
<li><code>MultiThreaded</code> - the static library</li>
<li><code>MultiThreadedDebug</code> - the static library with debug information</li>
</ul>
<p>By default, the dynamic library is used. To set the static library, use:</p>
<pre><code class="language-cmake">set(CMAKE_MSVC_RUNTIME_LIBRARY &quot;MultiThreaded$&lt;$&lt;CONFIG:Debug&gt;:Debug&gt;&quot;)
</code></pre>
<p>This way, the static library with debug information is used in the Debug mode, and the static library is used in the Release mode.</p>
<p><strong>Note that the <code>CMAKE_MSVC_RUNTIME_LIBRARY</code> variable was introduced in CMake 3.15. Therefore, you have to set <code>cmake_minimum_required(VERSION 3.15)</code> in the <code>CMakeLists.txt</code> file, or set the CMP0091 policy to <code>NEW</code> using the <code>cmake_policy</code> command.</strong></p>
<h3 id="compile-options">Compile options<a class="headerlink" href="#compile-options" title="Permanent link">&para;</a></h3>
<p>Most of the compile options are now sets automatically based on the declarations in the <code>CMakeLists.txt</code> file. However, some notable exceptions exists. To set such options, we have to use the <code>add_compile_options</code> command:</p>
<pre><code class="language-cmake">add_compile_options(&lt;option 1&gt; &lt;option 2&gt; ...)
</code></pre>
<h4 id="msvc">MSVC<a class="headerlink" href="#msvc" title="Permanent link">&para;</a></h4>
<ul>
<li><a href="https://learn.microsoft.com/en-us/cpp/build/reference/permissive-standards-conformance?view=msvc-170&amp;viewFallbackFrom=vs-2019"><code>/permissive-</code></a> to enable the strictest mode of the compiler</li>
</ul>
<h4 id="gcc">GCC<a class="headerlink" href="#gcc" title="Permanent link">&para;</a></h4>
<ul>
<li><a href="https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html"><code>-pedantic-errors</code></a> to report all cases where non-standard GCC extension is used and treat them as  errors</li>
</ul>
<h3 id="linker-options">Linker Options<a class="headerlink" href="#linker-options" title="Permanent link">&para;</a></h3>
<p>Linker options can be set with <code>add_link_options</code> command. Example: </p>
<pre><code class="language-Cmake">add_link_options(&quot;/STACK: 10000000&quot;)
</code></pre>
<h2 id="dependency-management">Dependency management<a class="headerlink" href="#dependency-management" title="Permanent link">&para;</a></h2>
<p>There are many ways how to manage dependencies in CMake, for complete overview, see the <a href="https://cmake.org/cmake/help/latest/guide/using-dependencies/index.html#guide:Using%20Dependencies%20Guide">documentation</a>. </p>
<p>Although it is possible to hard-code the paths for includes and linking, it is usually better to initialize the paths automatically using a rich set of commands cmake offers.  It has the following advatages:</p>
<ul>
<li>Hardcoding the paths is error-prone, while cmake commands usually deliver correct paths</li>
<li>It boost the productivity as we do not have to investigate where each library is installed</li>
<li>The resulting <code>CMakeLists.txt</code> file is more portable</li>
<li>And most importantly, <strong>potential errors concerning missing libraries are reported prior to the compilation/linking</strong>.</li>
</ul>
<p>Most of the libraries have CMake support, so their CMake variables can be initialized simply by calling the <code>find_package</code> command described below. These packages have either:</p>
<ul>
<li>their own cmake config (cmake-aware libs usually installed through the package manager like <code>vcpkg</code>)</li>
<li>or they have a <code>Find&lt;package name&gt;</code> script created by someone else that heuristically search for the packege (The default location for these scripts is <code>CMake/share/cmake-&lt;version&gt;/Modules</code>). </li>
</ul>
<p>For packages without the CMake support, we have to use lower-level cmake commands like <code>find_path</code> or <code>find_libraries</code>. For convinience, we can put these command to our own <code>Find&lt;name&gt;</code> script taht can be used by multiple project or even shared. </p>
<h3 id="standard-way-find_package">Standard way: <code>find_package</code><a class="headerlink" href="#standard-way-find_package" title="Permanent link">&para;</a></h3>
<p>The <a href="https://cmake.org/cmake/help/latest/command/find_package.html"><code>find_package</code></a> command is the primary command for dependencies. It tries to find the correct variables for a library. The command sets:</p>
<ul>
<li>the <code>&lt;PackageName&gt;_FOUND</code> variable to <code>TRUE</code> or <code>1</code> if the package is found</li>
<li>include paths</li>
<li>linking paths</li>
<li>platform/toolchain specific enviromental variables</li>
</ul>
<p>There are two modes of operation for the command</p>
<ul>
<li><em>module mode</em>, which uses the <code>Find&lt;library name&gt;</code> cmake scripts, typically provided not by the library developers, but somebody else who wants the libraries to be accessible by CMake. All modules provided by CMake itself are listed in the <a href="https://cmake.org/cmake/help/latest/manual/cmake-modules.7.html#find-modules">documentation</a>.</li>
<li><em>config mode</em> which uses CMake scripts with name <code>&lt;PackageName&gt;Config.cmake</code> or <code>&lt;lowercasePackageName&gt;-config.cmake</code> provided by the developers of the package. They are typically distributed with the source code and downloaded by the package manager.</li>
</ul>
<p>To decide the operation mode, the <code>find_package</code> command uses the following logic:</p>
<ul>
<li>if the <code>MODULE</code> parameter is used, the module mode is used</li>
<li>if the <code>CONFIG</code> or <code>No_MODULE</code> parameter is used, the config mode is used</li>
<li>if some parameters from the full (advanced) signature of the <code>find_package</code> command are used (e.g.: <code>NAMES</code>), the config mode is used</li>
<li>otherwise, by default, the module mode is used with the fallback to the config mode if the module is not found</li>
</ul>
<h4 id="config-mode">Config mode<a class="headerlink" href="#config-mode" title="Permanent link">&para;</a></h4>
<p>Config packages are CMake modules that were created as cmake projects by their developers. They are therefore naturally integrated into Cmake.</p>
<p>The configuration files are executed as follows:</p>
<ol>
<li>Package version file: <code>&lt;package name&gt;-config-version.cmake</code> or <code>&lt;package name&gt;ConfigVersion.cmake</code>. This file handles the version compatibility, i.e., it ensures that the installed version of the package is compatible with the version requested in the <code>find_package</code> command.</li>
<li>Package configuration file: <code>&lt;package name&gt;-config.cmake</code> or <code>&lt;package name&gt;Config.cmake</code>.</li>
</ol>
<p>The process of searching for these files is very complex. For the full description, see the <a href="https://cmake.org/cmake/help/latest/command/find_package.html#search-procedure">documentation</a>. The most important steps are:</p>
<ol>
<li>Search the directory specified by the <code>CMAKE_FIND_PACKAGE_REDIRECT_DIR</code> variable. Typically, this variable is set to <code>&lt;build dir&gt;/CMakeFiles/pkgRedirects</code>.</li>
<li>Search specified subdirectories of a <code>&lt;prefix path&gt;</code>. Multiple <code>&lt;prefix path&gt;</code> variables are considered in the following order:<ol>
<li>Package-specific prefix paths, in the following order:<ol>
<li><code>&lt;PackageName&gt;_ROOT</code> CMake variable</li>
<li><code>&lt;PACKAGENAME&gt;_ROOT}</code> CMake variable</li>
<li><code>&lt;PackageName&gt;_ROOT</code> environment variable</li>
<li><code>&lt;PACKAGENAME&gt;_ROOT}</code> environment variable</li>
</ol>
</li>
<li>Prefix paths specified in CMake cache variables, in the following order:<ol>
<li><code>CMAKE_PREFIX_PATH</code> CMake variable</li>
<li><code>CMAKE_FRAMEWORK_PATH</code> CMake variable</li>
<li><code>CMAKE_APPBUNDLE_PATH</code> CMake variable</li>
</ol>
</li>
<li>Prefix paths specified in CMake environment variables, in the following order:<ol>
<li><code>&lt;PackageName&gt;_DIR</code> CMake variable</li>
<li><code>CMAKE_PREFIX_PATH</code> environment variable</li>
<li><code>CMAKE_FRAMEWORK_PATH</code> environment variable</li>
<li><code>CMAKE_APPBUNDLE_PATH</code> environment variable</li>
</ol>
</li>
<li>And much more...</li>
</ol>
</li>
</ol>
<h4 id="module-mode">Module mode<a class="headerlink" href="#module-mode" title="Permanent link">&para;</a></h4>
<p>Module packages are packages that are not cmake projects themselves, but are hooked into cmake using custom find module scrips. These scripts are automatically executed by <code>find_package</code>.</p>
<p>The find module script is named <code>Find&lt;package name&gt;.cmake</code>. The <code>find_package</code> command searches for these scripts in:</p>
<ol>
<li>the <code>CMAKE_MODULE_PATH</code> directories, and then  </li>
<li>int the CMake installation, e.g.: <code>CMake/share/cmake-3.22/Modules/Find&lt;package name&gt;.cmake</code>.</li>
</ol>
<h3 id="searching-for-include-directories-with-find_path">Searching for include directories with <code>find_path</code><a class="headerlink" href="#searching-for-include-directories-with-find_path" title="Permanent link">&para;</a></h3>
<p>The <a href="https://cmake.org/cmake/help/latest/command/find_path.html"><code>find_path</code></a> command is intended to find the path (e.g., an include directory).
A simple syntax is:</p>
<pre><code class="language-cmake">find_path(
    &lt;var name&gt;
    NAMES &lt;file names&gt;
    PATHS &lt;paths&gt;
)
</code></pre>
<p>Here:</p>
<ul>
<li><code>&lt;var name&gt;</code> is the name of the resulting variable</li>
<li><code>&lt;file names&gt;</code> are <strong>all possible</strong> file names split by space. At least one of the files needs to be present in a path for it to be considered to be the found path.</li>
<li><code>&lt;paths&gt;</code> are candidate paths split by space</li>
</ul>
<h3 id="low-level-command-find_library">Low level command: <code>find_library</code><a class="headerlink" href="#low-level-command-find_library" title="Permanent link">&para;</a></h3>
<p>The <a href="https://cmake.org/cmake/help/latest/command/find_library.html"><code>find_library</code></a> command is used to populate a variable with a result of a specific file search optimized for libraries. </p>
<p>The search algorithm works as follows:</p>
<ol>
<li>?</li>
<li>Search package paths<ul>
<li>order:<ol>
<li><code>&lt;CurrentPackage&gt;_ROOT</code>, </li>
<li><code>ENV{&lt;CurrentPackage&gt;_ROOT}</code>, </li>
<li><code>&lt;ParentPackage&gt;_ROOT</code>,</li>
<li><code>ENV{&lt;ParentPackage&gt;_ROOT}</code></li>
</ol>
</li>
<li>this only happens if the <code>find_library</code> command is called from within a <code>find_&lt;module&gt;</code> or <code>find_package</code></li>
<li>this step can be skipped using the <code>NO_PACKAGE_ROOT_PATH</code> parameter </li>
</ul>
</li>
<li>Search path from cmake cache. During a clean cmake generation, these can be only supplied by command line. <ul>
<li>Considered variables:<ul>
<li><code>CMAKE_LIBRARY_ARCHITECTURE</code></li>
<li><code>CMAKE_PREFIX_PATH</code></li>
<li><code>CMAKE_LIBRARY_PATH</code></li>
<li><code>CMAKE_FRAMEWORK_PATH</code></li>
</ul>
</li>
<li>this step can be skipped using the <code>NO_CMAKE_PATH</code> parameter</li>
</ul>
</li>
<li>Same as step 3, but the variables are searched among system environmental variables instead<ul>
<li>this step can be skipped using the <code>NO_CMAKE_ENVIRONMENT_PATH</code> parameter</li>
</ul>
</li>
<li>Search paths specified by the <code>HINTS</code> option</li>
<li>Search the standard system environmental paths<ul>
<li>variables considered are <code>LIB</code> and <code>PATH</code></li>
<li>this step can be skipped using the <code>NO_SYSTEM_ENVIRONMENT_PATH</code> parameter</li>
</ul>
</li>
<li>Search in system paths<ul>
<li>Considered variables:<ul>
<li><code>CMAKE_LIBRARY_ARCHITECTURE</code></li>
<li><code>CMAKE_SYSTEM_PREFIX_PATH</code></li>
<li><code>CMAKE_SYSTEM_LIBRARY_PATH</code></li>
<li><code>CMAKE_SYSTEM_FRAMEWORK_PATH</code></li>
</ul>
</li>
<li>this step can be skipped using the <code>NO_CMAKE_SYSTEM_PATH</code> parameter</li>
</ul>
</li>
<li>Search the paths specified by the <code>PATHS</code> option</li>
</ol>
<h4 id="searching-for-libraries-in-the-project-dir">Searching for libraries in the project dir<a class="headerlink" href="#searching-for-libraries-in-the-project-dir" title="Permanent link">&para;</a></h4>
<p>Note that the project dir is not searched by default. To include in the search, use: <code>HINTS ${PROJECT_SOURCE_DIR}</code>. Full example on the Gurobi lib stored in <code>&lt;CMAKE LISTS DIR/lib/gurobi_c++.a&gt;</code>:</p>
<pre><code class="language-cmake">find_library(GUROBI_CXX_LIBRARY
    NAMES gurobi_c++
    HINTS ${PROJECT_SOURCE_DIR}
    PATH_SUFFIXES lib
    NO_CMAKE_ENVIRONMENT_PATH
    REQUIRED
)
</code></pre>
<h3 id="creating-a-custom-find-script">Creating a custom find script<a class="headerlink" href="#creating-a-custom-find-script" title="Permanent link">&para;</a></h3>
<p>The structure of a simple find scripts is described in the <a href="https://cmake.org/cmake/help/latest/manual/cmake-developer.7.html#find-modules">documentation</a>. </p>
<p>We can either put the find script to the default location, so it will be available for all projects, or we can put it in the project directory and add that directory to the <code>CMAKE_MODULE_PATH</code>:</p>
<pre><code class="language-cmake">list(APPEND CMAKE_MODULE_PATH &quot;${CMAKE_CURRENT_LIST_DIR}/cmake&quot;)
</code></pre>
<p>The usual structure of the find script is:</p>
<ol>
<li>the comment section describing the file:</li>
</ol>
<pre><code class="language-cmake">#[=======================================================================[.rst:
FindMOSEK

-------

Finds the MOSEK library.

Result Variables
^^^^^^^^^^^^^^^^
This will define the following variables:

``MOESK_FOUND``
  True if the system has the MOSEK library.
``MOSEK_INCLUDE_DIRS``
  Include directories needed to use MOSEK.
``MOSEK_LIBRARIES``
  Libraries needed to link to MOSEK.

#]=======================================================================]
</code></pre>
<ol>
<li>find commands that fils some temp variables:</li>
</ol>
<pre><code class="language-cmake">find_path(
    MOSEK_INCLUDE_DIR
    NAMES mosek.h
    PATHS &quot;$ENV{MOSEK_HOME}/h&quot;
)

find_library(
    MOSEK_LIBRARY
    NAMES libmosek64.so.10.0 libfusion64.so.10.0
    PATHS &quot;$ENV{MOSEK_HOME}/bin&quot;
)
</code></pre>
<ol>
<li>handeling of the result of the file commands. The standard approach is:</li>
</ol>
<pre><code class="language-cmake">include(FindPackageHandleStandardArgs)
find_package_handle_standard_args(MOSEK
  FOUND_VAR MOSEK_FOUND
  REQUIRED_VARS
    MOSEK_LIBRARY
    MOSEK_INCLUDE_DIR
)
</code></pre>
<ol>
<li>setting the final variables:</li>
</ol>
<pre><code class="language-cmake">if(MOSEK_FOUND)
    set(MOSEK_LIBRARIES ${MOSEK_LIBRARY})
    set(MOSEK_INCLUDE_DIRS ${MOSEK_INCLUDE_DIR})
endif()
</code></pre>
<h3 id="downolad-dependencies-during-configuration-and-build-them-from-source">Downolad dependencies during configuration and build them from source<a class="headerlink" href="#downolad-dependencies-during-configuration-and-build-them-from-source" title="Permanent link">&para;</a></h3>
<p>To download and build dependencies during the configuration, we can use the <a href="https://cmake.org/cmake/help/latest/module/FetchContent.html"><code>FetchContent</code></a> module. This way, the sources are downloaded at the configuration step, and built during the build step. Note that because of this, the usage of these dpendencies is limited, we cannot, for example, run the dependency tools at configuration time. For details, see the <a href="https://cmake.org/cmake/help/latest/guide/using-dependencies/index.html#fetchcontent-and-find-package-integration">dependency management documentation</a>.</p>
<p>The usual workflow is:</p>
<ol>
<li>Download the dependency using the <code>FetchContent_Declare</code> command
    <code>cmake
    FetchContent_Declare(
        &lt;NAME&gt;
        &lt;SPECIFICATION&gt;
        DOWNLOAD_EXTRACT_TIMESTAMP ON
    )</code><ul>
<li>The specification can be either a URL or a git repository.</li>
<li>The <code>DOWNLOAD_EXTRACT_TIMESTAMP</code> option ensures that the timestamp of the downloaded files is preserved. This is useful when the dependency is downloaded multiple times, and we want to avoid unnecessary rebuilds.
Note that <strong>this option shoud be placed before the URL option</strong>. This is because it was introduced in CMake 3.21, so if it is placed after the URL and the CMake version is lower than 3.21, the <code>FetchContent_Declare</code> command will fail as the option will be considered a part of the URL.</li>
</ul>
</li>
<li>Configure the dependency using the <a href="https://cmake.org/cmake/help/latest/module/FetchContent.html#command:fetchcontent_makeavailable"><code>FetchContent_MakeAvailable</code></a> command:
    <code>cmake
    FetchContent_MakeAvailable(&lt;NAME&gt;)</code><ul>
<li>If the dependency is a CMake project, the <code>FetchContent_MakeAvailable</code> command will automatically configure the project by calling the <code>add_subdirectory</code> command with the path to the downloaded source code.</li>
</ul>
</li>
</ol>
<p>Both the dependency source code and the build directory are stored in the build directory in <code>_deps</code> folder. This directory contains:</p>
<ul>
<li><code>&lt;NAME&gt;-src</code> - the source code of the dependency</li>
<li><code>&lt;NAME&gt;-build</code> - the build directory of the dependency</li>
</ul>
<h2 id="cmake-targets">CMake Targets<a class="headerlink" href="#cmake-targets" title="Permanent link">&para;</a></h2>
<p>Targets define logical units of the build process. These can be:</p>
<ul>
<li>executables</li>
<li>libraries</li>
<li>custom targets doing all sorts of things</li>
<li>sets of targets, i.e., aliases for building multiple targets at once</li>
</ul>
<p>Available targets are either user-defined or automatically generated by CMake.  </p>
<h3 id="executable-targets">Executable targets<a class="headerlink" href="#executable-targets" title="Permanent link">&para;</a></h3>
<p>The target definition is done using the <code>add_executable</code> command. The syntax is:</p>
<pre><code class="language-cmake">add_executable(&lt;target name&gt; &lt;source file 1&gt; &lt;source file 2&gt; ...)
</code></pre>
<p>The target name is used to refer to the target in other commands. The target name is also used to name the output file. </p>
<p>The list of source files should contain all the source files that are needed to build the target. There are some automatic mechanisms that can be used to add the source files (discussed e.g. on <a href="https://discourse.cmake.org/t/is-glob-still-considered-harmful-with-configure-depends/808/2">cmake forums</a>), but they are not recommended.</p>
<h3 id="library-targets">Library targets<a class="headerlink" href="#library-targets" title="Permanent link">&para;</a></h3>
<p>Library targets are defined using the <code>add_library</code> command. The syntax is:</p>
<pre><code class="language-cmake">add_library(&lt;target name&gt; &lt;type&gt; &lt;source file 1&gt; &lt;source file 2&gt; ...)
</code></pre>
<h3 id="targets-automatically-generated-by-cmake">Targets automatically generated by CMake<a class="headerlink" href="#targets-automatically-generated-by-cmake" title="Permanent link">&para;</a></h3>
<p><a href="https://cmake.org/cmake/help/latest/guide/user-interaction/index.html#selecting-a-target">listed here</a>.</p>
<p>Besides the user-defined targets, CMake automatically generates some targets. These are:</p>
<ul>
<li><strong>all</strong>: alias for building all targets. Default target if the <code>--target</code> argument is not specified. <ul>
<li>In Visual Studio and Xcode generators, this target is called <code>ALL_BUILD</code>.</li>
<li>we can exclude some targets from the <code>all</code> target using the <a href="https://cmake.org/cmake/help/latest/prop_tgt/EXCLUDE_FROM_ALL.html#prop_tgt:EXCLUDE_FROM_ALL"><code>EXCLUDE_FROM_ALL</code> target property</a> or the <a href="https://cmake.org/cmake/help/latest/prop_dir/EXCLUDE_FROM_ALL.html#prop_dir:EXCLUDE_FROM_ALL"><code>EXCLUDE_FROM_ALL</code> directory property</a>.</li>
</ul>
</li>
<li><strong>clean</strong> target that cleans the build directory</li>
<li><strong>install</strong> target that installs the project. It depends on the <code>all</code> target.<ul>
<li>this target is only available if the <code>CMakelists.txt</code> file contains the <code>install</code> command (see <a href="#installation-configuration">installation configuration</a>).</li>
</ul>
</li>
<li>and some more...</li>
</ul>
<h3 id="set-properties-for-a-target">Set properties for a target<a class="headerlink" href="#set-properties-for-a-target" title="Permanent link">&para;</a></h3>
<p>To set <strong>compile options</strong> for a target, use the <a href="https://cmake.org/cmake/help/latest/command/target_compile_definitions.html"><code>target_compile_definitions</code></a> command. The syntax is:</p>
<pre><code class="language-cmake">target_compile_definitions(&lt;target name&gt; &lt;SCOPE&gt; &lt;definition 1&gt; &lt;definition 2&gt; ...)
</code></pre>
<h2 id="include-directories">Include directories<a class="headerlink" href="#include-directories" title="Permanent link">&para;</a></h2>
<p>To include the headers, we need to use a <code>inlude_directories</code> (global), or better <code>target_include_directories</code> command. The difference:</p>
<ul>
<li><strong>target specification</strong>: <code>target_include_directories</code> specifies the include directories for a specific target, while <code>include_directories</code> specifies the include directories for all targets in the current directory.</li>
<li><strong>mode specification</strong>: <code>target_include_directories</code> specifies the mode of the include directories (e.g., <code>PUBLIC</code>, <code>PRIVATE</code>, <code>INTERFACE</code>), while <code>include_directories</code> behaves simillar to <code>PRIVATE</code>. Therefore, for libraries, the <code>target_include_directories</code> has to be used.</li>
</ul>
<h3 id="inspect-the-include-directories">Inspect the Include directories<a class="headerlink" href="#inspect-the-include-directories" title="Permanent link">&para;</a></h3>
<p>All the global include directories are stored in the <code>INCLUDE_DIRECTORIES</code> property, to print them, add this to the <code>CMakeLists.txt</code> file:</p>
<pre><code class="language-cmake">get_property(dirs DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR} PROPERTY INCLUDE_DIRECTORIES)
foreach(dir ${dirs})
  message(STATUS &quot;dir='${dir}'&quot;)
endforeach()
</code></pre>
<h2 id="linking-configuration">Linking configuration<a class="headerlink" href="#linking-configuration" title="Permanent link">&para;</a></h2>
<p>For linking, use the <a href="https://cmake.org/cmake/help/latest/command/target_link_libraries.html"><code>target_link_libraries</code></a> command.</p>
<p>The general syntax is:</p>
<pre><code class="language-cmake">target_link_libraries(&lt;target name&gt; &lt;library 1&gt; &lt;library 2&gt; ...)
</code></pre>
<p>We can use multiple commands for a single target:</p>
<pre><code class="language-cmake">target_link_libraries(&lt;target name&gt; &lt;library 1&gt;)
target_link_libraries(&lt;target name&gt; &lt;library 2&gt;)
</code></pre>
<p>Make sure that you <strong>always link against all the libraries that are needed for the target to work!</strong> Do not rely on the linker errors, these may not appear due to library preloading, indirect linkage, advanced linker heuristics, etc. The result is that on one machine the code will work, but on another, it will fail. To find out if and how to link against a library, refer to the documentation of the library.</p>
<p>The <code>&lt;library&gt;</code> can be:</p>
<ul>
<li>a <strong>library target name</strong>: The name of the target that is defined using the <code>add_library</code> command.<ul>
<li>this is the way how to link against vcpkg libraries</li>
<li>check the usage file of the library for the correct target name</li>
</ul>
</li>
<li>a <strong>full path to the library file</strong></li>
<li>a <strong>library name</strong>: The name of the library without any prefix (e.g., <code>-l</code>) or suffix (e.g., <code>.a</code>, <code>.so</code>, <code>.dll</code>).<ul>
<li>this works for the system libraries and other libraries that are in the system path</li>
</ul>
</li>
<li>a <strong>link flag</strong>: A flag that is passed to the linker.<ul>
<li>for libraries integrated with the linker</li>
</ul>
</li>
<li>a <strong>generator expression</strong>: A generator expression that is evaluated during the CMakelists.txt configuration to one of the above options.</li>
</ul>
<p><strong>Note that cmake does not check the validity of the supplied <code>&lt;library&gt;</code> argument!</strong>. Always check the documentation of the library to find out how to link against it. If we want to double-check that the supplied <code>&lt;library&gt;</code> is valid, we can:</p>
<ul>
<li>for the library target name, check the presence of the target:
    <code>cmake
    if(NOT TARGET &lt;library&gt;)
        message(FATAL_ERROR "The target &lt;library&gt; does not exist!")
    endif()</code></li>
</ul>
<h3 id="checking-the-full-path-to-a-linked-library">Checking the full path to a linked library<a class="headerlink" href="#checking-the-full-path-to-a-linked-library" title="Permanent link">&para;</a></h3>
<p>Sometimes, it can be usefull to check the full path to a linked library. This can be done using the <code>get_target_property</code> command:</p>
<pre><code class="language-cmake">get_target_property(LIB_PATH &lt;library name&gt; IMPORTED_LOCATION)
message(STATUS &quot;LIB_PATH=${LIB_PATH}&quot;)
</code></pre>
<h2 id="handling-runtime-dependencies-in-the-output-directory">Handling runtime dependencies in the output directory<a class="headerlink" href="#handling-runtime-dependencies-in-the-output-directory" title="Permanent link">&para;</a></h2>
<p>When linking dynamically (e.g., by using dynamic toochain, which is default on Windows), the runtime dependencies must be available at runtime, otherwise the program will not run. On Windows, this is usually solved by copying the runtime dependencies to the output directory. There are several ways how to do that.</p>
<ul>
<li>when using <code>vcpkg</code>, the runtime dependencies are copied automatically if the <code>VCPKG_APPLOCAL_DEPS</code> variable is set to <code>ON</code></li>
<li>otherwise, we can copy the runtime dependencies using the <code>add_custom_command</code> command</li>
<li>or we can just manually copy the runtime dependencies to the output directory</li>
</ul>
<h3 id="copying-runtime-dependencies-using-add_custom_command">Copying runtime dependencies using <code>add_custom_command</code><a class="headerlink" href="#copying-runtime-dependencies-using-add_custom_command" title="Permanent link">&para;</a></h3>
<p>We can use the <a href="https://cmake.org/cmake/help/latest/command/add_custom_command.html"><code>add_custom_command</code></a> command together with the <a href="https://cmake.org/cmake/help/latest/manual/cmake-generator-expressions.7.html#genex:TARGET_RUNTIME_DLLS"><code>$&lt;TARGET_RUNTIME_DLLS:&lt;target name&gt;&gt;</code></a> generator expression. Be careful to wrap this code by a condition that checks the generator type, as the generator expression is only available for DLL-aware generators.</p>
<pre><code class="language-cmake">if(CMAKE_GENERATOR MATCHES &quot;Visual Studio.*&quot;)
    add_custom_command(
        TARGET &lt;target name&gt;
        POST_BUILD
        COMMAND ${CMAKE_COMMAND} -E copy $&lt;TARGET_RUNTIME_DLLS:&lt;target name&gt;&gt; $&lt;TARGET_FILE_DIR:&lt;target name&gt;&gt;
        COMMAND_EXPAND_LISTS
    )
endif()
</code></pre>
<p>Here, the <code>COMMAND_EXPAND_LISTS</code> is used to expand the generator expressions in the command. We use it for the <a href="https://cmake.org/cmake/help/latest/manual/cmake-generator-expressions.7.html#genex:TARGET_RUNTIME_DLLS"><code>$&lt;TARGET_RUNTIME_DLLS:&lt;target name&gt;&gt;</code></a> generator expression that returns the list of runtime dependencies of the target. </p>
<h3 id="runtime-dependencies-and-subdirectories">Runtime dependencies and subdirectories<a class="headerlink" href="#runtime-dependencies-and-subdirectories" title="Permanent link">&para;</a></h3>
<p>When using the <code>add_subdirectory</code> command, a new build directory is created for the subdirectory. However, the runtime dependencies in the parent directory are not accessible and therefore it must be duplicated in the subdirectory (<code>VCPKG_APPLOCAL_DEPS</code> handles this automatically). </p>
<p>One can think that we can solve that by using the same output directory for the parent and the subdirectory (using the <code>build dir</code> parameter of the <code>add_subdirectory command</code>). However, this is prohibited by CMake. </p>
<h2 id="installation-configuration">Installation Configuration<a class="headerlink" href="#installation-configuration" title="Permanent link">&para;</a></h2>
<p><a href="https://cmake.org/cmake/help/latest/guide/importing-exporting/index.html">Importing and Exporting Guide</a></p>
<p>To enable installation, we have to provide several commands and do some adjustments in the <code>CMakeLists.txt</code> file. Specific steps depends on what we want to achieve.</p>
<p>The minimal installation that installs only binaries and headers can be set up using two commands:</p>
<ul>
<li>
<p>Install binaries with the <a href="https://cmake.org/cmake/help/latest/command/install.html#targets"><code>install(TARGETS...</code></a> command. The basic syntax is:
    <code>cmake
    install(TARGETS &lt;target name 1&gt; &lt;target name 2&gt;)</code></p>
</li>
<li>
<p>Install headers with the <a href="https://cmake.org/cmake/help/latest/command/install.html#files"><code>install(FILES...</code></a> command. The basic syntax is:
    <code>cmake
    install(FILES &lt;file 1&gt; &lt;file 2&gt; DESTINATION &lt;destination&gt;)</code></p>
<ul>
<li>We have to install both public API headers and their internal dependencies. Usually, this means installing most of the headers.</li>
<li>The <code>&lt;destination&gt;</code> is the directory where the files will be installed. Typically, it is <code>${CMAKE_INSTALL_INCLUDEDIR}/${PROJECT_NAME}</code> for header files.</li>
<li>We usually only want a single set of headers to be installed for both Debug and Release builds (<strong>for vcpkg, this is required</strong>). This can be achieved by using the <code>CONFIGURATIONS</code> parameter of the <code>install</code> command. Example:
    <code>cmake
    install(
        FILES &lt;file 1&gt; &lt;file 2&gt; 
        DESTINATION &lt;destination&gt; 
        CONFIGURATIONS Release
    )</code></li>
</ul>
</li>
</ul>
<p>These commands provide the <code>install</code> target that builds all targets (it depends on the <code>all</code> target) and then installs the project, which means that it copies the binary files to the installation directory.</p>
<h3 id="install-cmake-files">Install CMake files<a class="headerlink" href="#install-cmake-files" title="Permanent link">&para;</a></h3>
<p>If we want our library to be used from CMake projects, the basic configuration is not enough. We have to provide the CMake configuration files that will be used by the <code>find_package</code> command when searching for the dependency. Usually, CMake packages have the following cmake files:</p>
<ul>
<li><code>&lt;package name&gt;Targes.cmake</code> - contains the targets that are installed by the package</li>
<li><code>&lt;package name&gt;Config.cmake</code> - contains the configuration of the package, i.e., the include directories, linking directories, and other variables that are needed to use the package.</li>
<li><code>&lt;package name&gt;ConfigVersion.cmake</code> - contains the version of the package and the compatibility check.</li>
</ul>
<h4 id="installing-the-targets-file">Installing the Targets file<a class="headerlink" href="#installing-the-targets-file" title="Permanent link">&para;</a></h4>
<p>This involves two steps:</p>
<ol>
<li>use the <code>EXPORT</code> parameter of the <code>install(TARGETS...</code> command to create a reference to installed targets that we can use further
    <code>cmake
    install(TARGETS &lt;target name 1&gt; &lt;target name 2&gt;
        EXPORT &lt;export name&gt;
    )</code><ul>
<li>The <code>&lt;export name&gt;</code> is the name of the export set that will be used in the CMake configuration file. Typically, it is <code>${PROJECT_NAME}Targets</code>.</li>
</ul>
</li>
<li>use the <a href="https://cmake.org/cmake/help/latest/command/install.html#export"><code>install(EXPORT...</code></a> command to install the cmake files
    <code>cmake
    install(EXPORT &lt;export name&gt;
        DESTINATION &lt;destination&gt;
        NAMESPACE &lt;namespace&gt;
    )</code><ul>
<li>The <code>&lt;export name&gt;</code> is the name of the export set that was used in the <code>install(TARGETS...</code> command</li>
<li>The <code>&lt;destination&gt;</code> is the directory where the CMake configuration files will be installed. Typically, it is (<a href="https://discourse.cmake.org/t/what-should-the-destination-be-for-a-header-only-librarys-cmake-config-file/8473">source</a>):<ul>
<li><code>${CMAKE_INSTALL_LIBDIR}/cmake/${PROJECT_NAME}</code> for binaries</li>
<li><code>share/cmake/${PROJECT_NAME}</code> for header-only libraries</li>
<li><strong>for vcpkg</strong>: <code>share/${PROJECT_NAME}</code>. Otherwise, we need to mess with the <code>CONFIG_PATH</code> parameter of the <code>vcpkg_cmake_config_fixup</code> function.</li>
<li>for using the <code>CMAKE_INSTALL_LIBDIR</code> variable, we have to include the <code>GNUInstallDirs</code> module using the <code>include</code> command.</li>
</ul>
</li>
<li>The <code>&lt;namespace&gt;</code> is the namespace that will be used in the CMake configuration file, and later in the <code>target_link_libraries</code> command of the dependent project. It is not required, but it is recommended because the namespace with <code>::</code> only searches between the exported targets, preventing a possible name clash with some library installed in the system.<ul>
<li>typically, it has the form of <code>&lt;project name&gt;::</code></li>
</ul>
</li>
</ul>
</li>
</ol>
<h4 id="installing-the-package-configuration-file-and-the-version-file">Installing the package configuration file and the version file<a class="headerlink" href="#installing-the-package-configuration-file-and-the-version-file" title="Permanent link">&para;</a></h4>
<p><a href="https://cmake.org/cmake/help/latest/guide/importing-exporting/index.html#creating-a-package-configuration-file">official guide - package config file</a></p>
<p><a href="https://cmake.org/cmake/help/latest/guide/importing-exporting/index.html#creating-a-package-version-file">official guide - version file</a></p>
<p>In order for these files to be portable, they should be generated. The appropriate functions for this are in the <a href="https://cmake.org/cmake/help/latest/module/CMakePackageConfigHelpers.html">`CMakePackageConfigHelpers module</a>, which has to be included. </p>
<p>To generate the package configuration file:</p>
<ol>
<li>
<p>create the input file somewhere in the project directory with the
name <code>&lt;package name&gt;Config.cmake.in</code> and fill it with the following content:
    ```cmake
    @PACKAGE_INIT@</p>
<p>include ("${CMAKE_CURRENT_LIST_DIR}/<package name>Targes.cmake")</p>
<p>optional content ...
<code>- The `@PACKAGE_INIT@` is a placeholder that will be replaced by the `write_basic_package_version_file` command.
1. then generate the package configuration file by ading the `configure_package_config_file` command to the `CMakeLists.txt` file:</code>cmake
configure_package_config_file(
    <path to in file>
    <path to package config file in the build dir>
    INSTALL_DESTINATION <cmake files installation path>
)
<code>``
- here, the &lt;cmake files installation path&gt; is the same as the</code><destination><code>parameter in the</code>install(EXPORT...` command.</p>
</li>
</ol>
<p>The version file is generated using the <a href="https://cmake.org/cmake/help/latest/module/CMakePackageConfigHelpers.html#write-basic-package-version-file"><code>write_basic_package_version_file</code></a> command. The syntax is:</p>
<pre><code class="language-cmake">write_basic_package_version_file(
    &lt;version file build path&gt;
    VERSION &lt;version&gt;
    COMPATIBILITY AnyNewerVersion
)
</code></pre>
<ul>
<li>The <code>&lt;version file build path&gt;</code> is the path where the version file will be generated. </li>
<li>The <code>&lt;version&gt;</code> is the version of the package. Typically, it is the version of the project: <code>${&lt;project name&gt;Major}.${&lt;project name&gt;Minor}.${&lt;project name&gt;Patch}</code>.</li>
</ul>
<p>Finally, to install both files, we use the <a href="https://cmake.org/cmake/help/latest/command/install.html#files"><code>install(FILES...</code></a> command:</p>
<pre><code class="language-cmake">install(FILES
    &lt;path to package config file in the build dir&gt;
    &lt;path to version file in the build dir&gt;
    DESTINATION &lt;cmake files installation path&gt;
)
</code></pre>
<h4 id="sanitation-of-the-public-include-directories">Sanitation of the public include directories<a class="headerlink" href="#sanitation-of-the-public-include-directories" title="Permanent link">&para;</a></h4>
<p>Additionally, an extra step is needed in case we define include directories to be accessible from other projects (i.e., <code>PUBLIC</code> or <code>INTERFACE</code> mode). In this case, we have to use a special configuration for those directories so that a different path is used when the library is installed. For example, if we include the <code>src</code> directory using:</p>
<pre><code class="language-cmake">target_include_directories(&lt;target name&gt; PUBLIC ${CMAKE_CURRENT_SOURCE_DIR}/src)
</code></pre>
<p>we have to change it to:</p>
<pre><code class="language-cmake">target_include_directories(&lt;target name&gt; PUBLIC
    $&lt;BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/src&gt;
    $&lt;INSTALL_INTERFACE:include&gt;
)
</code></pre>
<h4 id="handling-dependencies">Handling dependencies<a class="headerlink" href="#handling-dependencies" title="Permanent link">&para;</a></h4>
<p>If our library depends on other libraries, the targets depending on our library may also need to link against these dependencies. The linking itself is automatically handled by CMake. However, we need to provide the variables that are needed for the in the package configuration file (<code>&lt;packag name.cmake.in</code>). To do so, we use the <code>find_dependency</code> command from the <a href="https://cmake.org/cmake/help/latest/module/CMakeFindDependencyMacro.html">`CMakeFindDependencyMacro module</a>:</p>
<pre><code class="language-cmake">@PACKAGE_INIT@

include(CMakeFindDependencyMacro)

find_dependency(&lt;dependency 1&gt;)
...
find_dependency(&lt;dependency n&gt;)

include(&quot;${CMAKE_CURRENT_LIST_DIR}/&lt;package name&gt;Targets.cmake&quot;)

...
</code></pre>
<p>The name of the dependency is the name of the package that is used in the <code>find_package</code> command in the <code>CMakeLists.txt</code> file. Other parameters (<code>REQUIRED</code>, <code>CONFIG</code>, etc.) are not needed as they are inherited from the <code>find_package</code> command.</p>
<h3 id="specify-the-targets-to-install">Specify the targets to install<a class="headerlink" href="#specify-the-targets-to-install" title="Permanent link">&para;</a></h3>
<p>The <a href="https://cmake.org/cmake/help/latest/command/install.html"><code>install</code></a>
 command has a parameter <code>TARGETS</code> that can specify the targets that should be installed. The syntax is:</p>
<p>However, <strong>the <code>TARGETS</code> parameter only affects the installation part of the <code>install</code> target</strong>. In other words, it determines what files are copied to the installation directory, but it does not affect the build process. Therefore, <strong>all targets are built regardless of the <code>TARGETS</code> parameter</strong>.</p>
<p>To prevent the building of some targets when installing, we have several options:</p>
<ul>
<li>exclude selected targets from the <code>all</code> target using the <a href="https://cmake.org/cmake/help/latest/prop_tgt/EXCLUDE_FROM_ALL.html#prop_tgt:EXCLUDE_FROM_ALL"><code>EXCLUDE_FROM_ALL</code> target property</a> or the <a href="https://cmake.org/cmake/help/latest/prop_dir/EXCLUDE_FROM_ALL.html#prop_dir:EXCLUDE_FROM_ALL"><code>EXCLUDE_FROM_ALL</code> directory property</a>.</li>
<li>disable building for the <code>install</code> target and use a custom wrapper target that builds only the targets that should be installed and then calls the <code>install</code> target.</li>
</ul>
<h4 id="selecting-the-targets-to-build-using-the-exclude_from_all-property">Selecting the targets to build using the <code>EXCLUDE_FROM_ALL</code> property<a class="headerlink" href="#selecting-the-targets-to-build-using-the-exclude_from_all-property" title="Permanent link">&para;</a></h4>
<p>For user targets added by the <code>add_executable</code> or <code>add_library</code> command, we can use the <a href="https://cmake.org/cmake/help/latest/prop_tgt/EXCLUDE_FROM_ALL.html#prop_tgt:EXCLUDE_FROM_ALL"><code>EXCLUDE_FROM_ALL</code></a> target property:</p>
<pre><code class="language-cmake">add_executable(my_target EXCLUDE_FROM_ALL &lt;source file 1&gt; &lt;source file 2&gt; ...)
</code></pre>
<p>For targets added by the <code>FetchContent_MakeAvailable</code> command. The situation is more complicated. The <code>FetchContent_Declare</code> command provides the <code>EXCLUDE_FROM_ALL</code> option, but it does not work as expected. Instead, we have to set the <code>EXCLUDE_FROM_ALL</code> property for the target after the <code>FetchContent_MakeAvailable</code> command:</p>
<pre><code class="language-cmake">FetchContent_Declare(
    &lt;declaration name&gt;
    ...
)
FetchContent_MakeAvailable(&lt;declaration name&gt;)
set_target_properties(&lt;target name&gt; PROPERTIES EXCLUDE_FROM_ALL TRUE)
</code></pre>
<h4 id="disabling-the-building-of-the-install-target-and-using-a-custom-wrapper-target">Disabling the building of the <code>install</code> target and using a custom wrapper target<a class="headerlink" href="#disabling-the-building-of-the-install-target-and-using-a-custom-wrapper-target" title="Permanent link">&para;</a></h4>
<p>For this solution,we first need to disable the building of the <code>install</code> using: <code>set(CMAKE_SKIP_INSTALL_ALL_DEPENDENCY true)</code>. Then, we need to create a target that: a) builds the selected targets, b) calls the <code>install</code> target. </p>
<p><a href="https://cmake.org/cmake/help/latest/variable/CMAKE_SKIP_INSTALL_ALL_DEPENDENCY.html#variable:CMAKE_SKIP_INSTALL_ALL_DEPENDENCY"><code>CMAKE_SKIP_INSTALL_ALL_DEPENDENCY</code> documentation</a> </p>
<h3 id="support-both-shared-and-static-libraries">Support both shared and static libraries<a class="headerlink" href="#support-both-shared-and-static-libraries" title="Permanent link">&para;</a></h3>
<p>Sometimes, we want the user to be able to choose between shared and static libraries when installing the package. For vcpkg, this is required. To add this support, we have to:</p>
<ol>
<li>define option for choosing the shared or static library (most likely, we do not want to install both)</li>
<li>install the correct library target based on the option</li>
<li>install the export header file (in both cases, as we use the same headers for both shared and static libraries)</li>
</ol>
<p>The conditional installation can look like this:</p>
<pre><code class="language-cmake">if(&lt;package name&gt;_BUILD_SHARED_LIBS)
    set_target_properties(&lt;static lib target&gt; PROPERTIES EXCLUDE_FROM_ALL TRUE)
    install(TARGETS &lt;shared lib target&gt; EXPORT &lt;export name&gt;)
else()
    set_target_properties(&lt;shared lib target&gt; PROPERTIES EXCLUDE_FROM_ALL TRUE)
    set_target_properties(&lt;static lib target&gt; PROPERTIES EXPORT_NAME &lt;shared lib target&gt;) # this aligns the name of the exported targets
    install(TARGETS &lt;static lib target&gt; EXPORT &lt;export name&gt;)
endif()
</code></pre>
<p>Here, the <code>set_target_properties</code> command is used to exclude the other target from the <code>all</code> target, effectively preventing it from being built during the installation. The <code>install</code> command is then used to install the correct target.</p>
<p>Finally, we just copy the export header file to the installation directory:</p>
<pre><code class="language-cmake">install(FILES ${CMAKE_CURRENT_BINARY_DIR}/&lt;export header file&gt; DESTINATION &lt;install include dir&gt;)
</code></pre>
<h3 id="support-both-debug-and-release-builds">Support both Debug and Release builds<a class="headerlink" href="#support-both-debug-and-release-builds" title="Permanent link">&para;</a></h3>
<p>In vcpkg, the Debug and Release builds are separated automatically, so the side-by-side installation of Debug and Release builds is supported out of the box. However, for other installations, e.g., when installing the package using the CMake <code>install</code> command, we have to take care of this ourselves. </p>
<p>The standard way to do that is to add a postfix to all targets so that the debug binaries can be distinguished from the release binaries and one installation does not overwrite the other. For that, set the <a href="https://cmake.org/cmake/help/latest/prop_tgt/DEBUG_POSTFIX.html"><code>DEBUG_POSTFIX</code> property</a> for each target:</p>
<pre><code class="language-cmake">set_target_properties(
    &lt;target name&gt;
    PROPERTIES DEBUG_POSTFIX &lt;postfix&gt;
)
</code></pre>
<p>Usually, the postfix is <code>d</code> is used for debug builds. When using this postfix, no further configuration is needed, the correct binary will be used in the client depending on its own configuration.</p>
<h3 id="installation-of-executables">Installation of executables<a class="headerlink" href="#installation-of-executables" title="Permanent link">&para;</a></h3>
<p>Executables are installed just like libraries. There are two differences:</p>
<ul>
<li>we do not need to export the executables, so we skip the <code>EXPORT</code> parameter of the <code>install(TARGETS...</code> command</li>
<li>on windows, when linking the executable to shared libraries and not using vcpkg, we have to manually copy the runtime dependencies to the installation bin directory. As this is done after build, we can use the <a href="https://cmake.org/cmake/help/latest/manual/cmake-generator-expressions.7.html#genex:TARGET_RUNTIME_DLLS"><code>TARGET_RUNTIME_DLLS</code></a> generator expression:
    <code>cmake
    install(FILES $&lt;TARGET_RUNTIME_DLLS:&lt;target name&gt;&gt; DESTINATION ${CMAKE_INSTALL_BINDIR})</code></li>
</ul>
<h3 id="specific-configuration-for-frequentlly-used-libraries">Specific configuration for frequentlly used libraries<a class="headerlink" href="#specific-configuration-for-frequentlly-used-libraries" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>for google test, we want to prevent the installation of the <code>gtest</code> targets. To do that, turn it off before the gtets config in the <code>CMakeLists.txt</code> file:
    ```cmake
    # GOOGLE TEST
    # do not install gtest
    set(INSTALL_GTEST OFF)</p>
<p>include(FetchContent)
FetchContent_Declare(
    googletest
    URL https://github.com/google/googletest/archive/03597a01ee50ed33e9dfd640b249b4be3799d395.zip
)</p>
<h1 id="for-windows-prevent-overriding-the-parent-projects-compilerlinker-settings">For Windows: Prevent overriding the parent project's compiler/linker settings<a class="headerlink" href="#for-windows-prevent-overriding-the-parent-projects-compilerlinker-settings" title="Permanent link">&para;</a></h1>
<p>set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)
```</p>
</li>
</ul>
<h2 id="multiple-cmakeliststxt-files-in-subdirectories">Multiple <code>CMakeLists.txt</code> files in subdirectories<a class="headerlink" href="#multiple-cmakeliststxt-files-in-subdirectories" title="Permanent link">&para;</a></h2>
<p>The configuration can be modularized by splitting the <code>CMakeLists.txt</code> file into multiple files, each in a separate directory. Then, these files can be executed using the <a href="https://cmake.org/cmake/help/latest/command/add_subdirectory.html"><code>add_subdirectory</code></a> command in the main <code>CMake_lists.txt</code> file or one of the <code>CMakeLists.txt</code> files already added by the <code>add_subdirectory</code> command. This has several advantages:</p>
<ul>
<li>the configuration is more organized, it is easier to find the relevant part of the configuration or reuse the configuration in other projects</li>
<li>the configuration is more configurable, i.e., we can turn on or off the configuration of a specific part of the project.</li>
</ul>
<p>The order of execution follows the order of the <code>add_subdirectory</code> commands, i.e., the processing of the <code>CMakeLists.txt</code> containing the <code>add_subdirectory</code> command is paused until the added <code>CMakeLists.txt</code> file is processed.</p>
<h3 id="variables-scope">Variables scope<a class="headerlink" href="#variables-scope" title="Permanent link">&para;</a></h3>
<p>The variable scope for multiple <code>CMakeLists.txt</code> files is hierarchical. This means that the variables defined in the parent <code>CMakeLists.txt</code> file are visible in the child <code>CMakeLists.txt</code> file, but not vice versa.</p>
<h2 id="decide-based-on-the-build-configuration">Decide based on the build configuration<a class="headerlink" href="#decide-based-on-the-build-configuration" title="Permanent link">&para;</a></h2>
<p>Sometimes is essential to decide based on the build configuration in the <code>CMakeLists.txt</code> file. However, this is not possible for the multi-configuration generators like Visual Studio or Xcode because the build configuration is not known during the CMake configuration step. However, there are measures that can be taken to achieve the result for particular tasks.</p>
<p>For <code>install</code> command, we can use the <code>CONFIGURATIONS</code> parameter to install the files only for the selected build configuration. Example:</p>
<pre><code class="language-cmake">install(
    FILES &lt;file 1&gt; &lt;file 2&gt; 
    DESTINATION &lt;destination&gt; 
    CONFIGURATIONS Release
)
</code></pre>
<p>For building, there are ways to limit the build based on the build configuration for both single- and multi-configuration generators. For single configuration generators, we can use the <a href="https://cmake.org/cmake/help/latest/variable/CMAKE_BUILD_TYPE.html"><code>CMAKE_BUILD_TYPE</code></a> variable and simply exclude the target from the build using the <code>EXCLUDE_FROM_ALL</code> target property:</p>
<pre><code class="language-cmake">if(CMAKE_BUILD_TYPE STREQUAL &quot;Debug&quot;)
   set_target_properties(&lt;target name&gt; PROPERTIES EXCLUDE_FROM_ALL TRUE)
endif()
</code></pre>
<p>For multi-configuration generators, this variable is not set, but we can use the
<code>EXCLUDE_FROM_DEFAULT_BUILD_DEBUG</code> property:</p>
<pre><code class="language-cmake">set_target_properties(&lt;target name&gt; PROPERTIES EXCLUDE_FROM_DEFAULT_BUILD_DEBUG TRUE)
</code></pre>
<p>To support both single- and multi-configuration generators, we have to first check whether we use a single- or multi-configuration generator using the <a href="https://cmake.org/cmake/help/latest/variable/CMAKE_CONFIGURATION_TYPES.html"><code>CMAKE_CONFIGURATION_TYPES</code></a> variable and then set the property accordingly:</p>
<pre><code class="language-cmake">if(CMAKE_CONFIGURATION_TYPES)
    set_target_properties(&lt;target name&gt; PROPERTIES EXCLUDE_FROM_DEFAULT_BUILD_DEBUG TRUE)
else()
    if(CMAKE_BUILD_TYPE STREQUAL &quot;Debug&quot;)
        set_target_properties(&lt;target name&gt; PROPERTIES EXCLUDE_FROM_ALL TRUE)
    endif()
endif()
</code></pre>
<h2 id="executing-external-commands">Executing external commands<a class="headerlink" href="#executing-external-commands" title="Permanent link">&para;</a></h2>
<p>There are different ways to execute external commands in the <code>CMakeLists.txt</code>, the proper way depends on the time when we want to execute the command:</p>
<ul>
<li><strong>configuration time</strong>: use the <a href="https://cmake.org/cmake/help/latest/command/execute_process.html"><code>execute_process</code></a> command</li>
<li><strong>build time</strong>: use the <a href="https://cmake.org/cmake/help/latest/command/add_custom_command.html"><code>add_custom_command</code></a> command<ul>
<li>can be run both before and after the build step using the <code>PRE_BUILD</code> and <code>POST_BUILD</code> options</li>
</ul>
</li>
</ul>
<p>To both commands, we can pass the <code>COMMAND</code> as a list of strings, where the first string is the command to execute.</p>
<p>Additionally, when using the <code>add_custom_command</code> command, we can to use the <code>COMMAND_EXPAND_LISTS</code> option to expand the generator expressions in the command.</p>
<h1 id="cmake-cache">CMake Cache<a class="headerlink" href="#cmake-cache" title="Permanent link">&para;</a></h1>
<p>CMake has two types of variables:</p>
<ul>
<li><em>normal variables</em> that are used just like in any other programming language and</li>
<li><em>cache variables</em>, which are configured in the first cmake run and then stored in the <code>CMakeCache.txt</code> file in the build directory.
The <a href="https://cmake.org/cmake/help/book/mastering-cmake/chapter/CMake%20Cache.html">CMake cache</a> is an essential part of the CMake build system. It stores variables that are used to configure the build scripts. </li>
</ul>
<p>Cache variables can be set in the following ways:</p>
<ul>
<li>by the <a href="https://cmake.org/cmake/help/latest/command/set.html"><code>set</code></a> command in the <code>CMakeLists.txt</code> file with the <code>CACHE</code> option</li>
<li>by the <code>-D</code> command line argument: <code>cmake -D&lt;variable name&gt;=&lt;variable value&gt; &lt;dir&gt;</code></li>
<li>by the cmake GUI</li>
<li>by using the <code>-C</code> option: <code>cmake -C &lt;cache file&gt; &lt;dir&gt;</code></li>
</ul>
<p>The rule is that once a cache variable is set, it is not changed when the <code>cmake</code> command is run again (that is why it is called cache :) ). Moreover, the cache variables are not overwritten by the <code>set</code> command in the <code>CMakeLists.txt</code> file. In other words, the <code>set</code> command in the <code>CMakeLists.txt</code> is only used to set the default value of the variable. If the variable is already set in the cache, the <code>set</code> command is ignored. However, the cache variables can be still overridden from the <code>CMakeLists.txt</code> if the <code>set</code> command is used without the <code>CACHE</code> option (by normal variables).</p>
<h1 id="cmake-directory-structure">CMake Directory Structure<a class="headerlink" href="#cmake-directory-structure" title="Permanent link">&para;</a></h1>
<h2 id="system-find_xxxcmake-files">System Find_XXX.cmake files<a class="headerlink" href="#system-find_xxxcmake-files" title="Permanent link">&para;</a></h2>
<p>The system find scripts are located in the <code>CMake/share/cmake-&lt;version&gt;/Modules/</code> directory.</p>
<h1 id="various-tasks">Various Tasks<a class="headerlink" href="#various-tasks" title="Permanent link">&para;</a></h1>
<h2 id="showing-the-generator-for-a-configured-directory">Showing the generator for a configured directory<a class="headerlink" href="#showing-the-generator-for-a-configured-directory" title="Permanent link">&para;</a></h2>
<p>If the configuration step is already done, we can show the generator used for the configuration by reading the <code>CMAKE_GENERATOR</code> variable from the <code>CMakeCache.txt</code> file:</p>
<pre><code class="language-powershell">Get-Content CMakeCache.txt | Select-String -Pattern &quot;CMAKE_GENERATOR&quot;
</code></pre>
<h2 id="display-available-generators">Display available generators<a class="headerlink" href="#display-available-generators" title="Permanent link">&para;</a></h2>
<p>Unfortunately, there is no way how to display the available generators on the machine [<a href="https://gitlab.kitware.com/cmake/cmake/-/issues/25397">source</a>]. We can only list the generators that are compatible with the system by running the <code>cmake --help</code>.</p>
<p>However, typically, the default generator marked with the <code>*</code> is available.</p>
<h2 id="determine-the-binary-output-directory">Determine the binary output directory<a class="headerlink" href="#determine-the-binary-output-directory" title="Permanent link">&para;</a></h2>
<p>Sometimes, we need to know where the binary files are stored. Unfortunately, there is no direct way to get this information from the CMake variables. We can only get the directory in the post-build step for a binary target using the <code>TARGET_FILE_DIR</code> generator expression:</p>
<pre><code class="language-cmake"># prints the binary directory of the target after the build
add_custom_command(
    TARGET &lt;target name&gt;
    POST_BUILD
    COMMAND ${CMAKE_COMMAND} -E echo $&lt;TARGET_FILE_DIR:&lt;target name&gt;&gt; 
)
</code></pre>
<h1 id="debugging-cmake">Debugging CMake<a class="headerlink" href="#debugging-cmake" title="Permanent link">&para;</a></h1>
<h2 id="debugging-cmake-using-clion-cmake-debugger">Debugging CMake using CLion CMake debugger<a class="headerlink" href="#debugging-cmake-using-clion-cmake-debugger" title="Permanent link">&para;</a></h2>
<p><a href="https://www.jetbrains.com/help/clion/cmake-debug.html">documentation</a></p>
<p>In CLion, we can debug the CMake configuration process by:</p>
<ol>
<li>opening the <code>CMakeLists.txt</code> file</li>
<li>setting the breakpoint(s)</li>
<li>starting the debugging process<ul>
<li>by clicking on the play button which is located on the first line of the <code>CMakeLists.txt</code> file on the left side of the editor window.</li>
<li>or by clicking on the debug button in the main toolbar</li>
</ul>
</li>
</ol>
<h2 id="getting-a-a-complete-output-of-the-cmake-configuration">Getting a a complete output of the CMake configuration<a class="headerlink" href="#getting-a-a-complete-output-of-the-cmake-configuration" title="Permanent link">&para;</a></h2>
<p>We can get the complete output of the CMake configuration by running the <code>cmake</code> command with the <code>--trace</code> option. This can be especially useful when investigating included scripts, as the debuggers usually cannot step into CMake calls. Usually, the output is very long, so it is recommended to redirect it to a file:</p>
<pre><code class="language-powershell">cmake --trace &lt;dir&gt; *&gt; cmake_trace.txt
</code></pre>
<p>If we want to also expand the variables, we can use the <code>--trace-expand</code> option.</p>
<h1 id="testing-with-cmake">Testing with CMake<a class="headerlink" href="#testing-with-cmake" title="Permanent link">&para;</a></h1>
<p><a href="https://cmake.org/cmake/help/book/mastering-cmake/chapter/Testing%20With%20CMake%20and%20CTest.html">documentation</a></p>
<p>CMake has a built-in capability for organizing and running tests. This is useful, because for testing, we usually need information about the build configuration, which is already available in CMake.</p>
<p>To enable testing in a project, we have to:</p>
<ol>
<li>add <code>include(CTest)</code> to the <code>CMakeLists.txt</code> file,</li>
<li>add the individual tests using the <code>add_test</code> command, and</li>
<li>configure the project</li>
</ol>
<p>Then, we can run the tests using the <code>ctest</code> command.</p>
<h2 id="adding-tests">Adding tests<a class="headerlink" href="#adding-tests" title="Permanent link">&para;</a></h2>
<p>The <a href="https://cmake.org/cmake/help/latest/command/add_test.html"><code>add_test</code></a> command is used to add a test to the project. The syntax is:</p>
<pre><code class="language-cmake">add_test(NAME &lt;test name&gt; COMMAND &lt;command&gt;)
</code></pre>
<p>By default, the command is executed in the build directory. Therefore, we can directly call the project executable by using the target name.</p>
<p>We can also modify the test (e.g.: check the output of the test) using the <a href="https://cmake.org/cmake/help/latest/command/set_property.html"><code>set_property</code></a> command:</p>
<pre><code class="language-cmake">set_property(TEST &lt;test name&gt; PROPERTY &lt;property name&gt; &lt;property value&gt;)
</code></pre>
<p>The most useful properties are:</p>
<ul>
<li><a href="https://cmake.org/cmake/help/latest/prop_test/PASS_REGULAR_EXPRESSION.html#prop_test:PASS_REGULAR_EXPRESSION"><code>PASS_REGULAR_EXPRESSION</code></a>: a regular expression that the output of the test has to match:
    <code>cmake
    set_property(TEST &lt;test name&gt; PROPERTY PASS_REGULAR_EXPRESSION "expected output")</code></li>
</ul>
<h2 id="ctest-execution">CTest execution<a class="headerlink" href="#ctest-execution" title="Permanent link">&para;</a></h2>
<p><a href="https://cmake.org/cmake/help/latest/manual/ctest.1.html">documentation</a></p>
<p>The <code>ctest</code> executable run the tests configured with CMake and reports the results.</p>
<p>It can run in three modes:</p>
<ul>
<li><strong>Run Tests</strong> mode (default): runs the tests and reports the results</li>
<li><strong>Build and Test</strong> mode: builds the tests and then runs them<ul>
<li>activated by the <code>--build-and-test</code> argument</li>
</ul>
</li>
<li><strong>Dashboard</strong> mode: run CTest as a client of the <a href="https://www.cdash.org/">CDash</a> dashboard application.<ul>
<li>activated by one of the <code>-D</code> (<code>--dahboard</code>), <code>-M</code> (<code>--test-model</code>), <code>-S</code> (<code>--script</code>), or <code>-SP</code> (<code>--script-new-process</code>) arguments</li>
<li>this mode facilitates every phase of the testing process, from updating the source code to running the tests and collecting the results</li>
<li>if configured correctly, the results can be displayed on the CDash server dashboard</li>
</ul>
</li>
</ul>
<p>Important parameters for all modes:</p>
<ul>
<li><a href="https://cmake.org/cmake/help/latest/manual/ctest.1.html#cmdoption-ctest-C"><code>-C &lt;config&gt;</code></a>: specifies the configuration to use (e.g., <code>Debug</code>, <code>Release</code>, etc.)<ul>
<li>Only applies for multi-configuration generators</li>
<li>This configuration is used by the build step if the <code>CTEST_BUILD_COMMAND</code> variable is not set, but also in other steps, like running the tests. Therefore, it is important to set this parameter even if we provide a custom build command, otherwise, the tests will be skipped.</li>
</ul>
</li>
<li><code>-V</code>: verbose output</li>
<li><code>-VV</code>: very verbose output</li>
<li><code>-O &lt;file&gt;</code>: output the results to a file</li>
</ul>
<h3 id="run-tests-mode-default">Run Tests mode (default)<a class="headerlink" href="#run-tests-mode-default" title="Permanent link">&para;</a></h3>
<p>The default run mode expects the project to be configured and built. It simply runs the tests and reports the results. For multi-configurations generators, we have to specify the configuration using the <code>-C</code> argument.</p>
<h3 id="build-and-test-mode">Build and Test mode<a class="headerlink" href="#build-and-test-mode" title="Permanent link">&para;</a></h3>
<p>The build and test mode is activated by the <code>--build-and-test</code> argument. </p>
<p>Unlike the <code>cmake</code> command, the <code>ctest</code> command does not choose the generator automatically. Instead, we have to supply the generator using the <code>--build-generator</code> argument.</p>
<p>Other useful arguments:</p>
<ul>
<li><code>--build-options</code>: additional options for the <code>cmake</code> command, e.g., <code>--toolchain &lt;path&gt;</code> to specify the toolchain file</li>
</ul>
<h3 id="dashboard-mode">Dashboard mode<a class="headerlink" href="#dashboard-mode" title="Permanent link">&para;</a></h3>
<p><a href="https://cmake.org/cmake/help/book/mastering-cmake/chapter/CDash.html">CDash documentation at cmake.org</a></p>
<p>Unlike the previous two modes, the dashboard mode facilitates every phase of the testing process, namely:</p>
<ul>
<li>updating the source code from the version control system</li>
<li>configuring the project</li>
<li>building the project</li>
<li>running the tests</li>
<li>collecting the results</li>
<li>submitting the results to the CDash server</li>
</ul>
<p>This is iteself a strong argument for using the dashboard mode but the main advantage is that in this mode, we can see the results of the process on the CDash server dashboard. However, this feature requires some extra configuration.</p>
<p>There are two main ways to use the dashboard mode:</p>
<ul>
<li>configure the dashboard mode using the <code>-D</code> argument together with the dahsboard command line arguments</li>
<li>configure the dashboard mode using a cmake script and then run the script using the <code>-S</code> or <code>-SP</code> argument</li>
</ul>
<h4 id="using-the-dashboard-mode-configured-by-the-script">Using the Dashboard mode configured by the script<a class="headerlink" href="#using-the-dashboard-mode-configured-by-the-script" title="Permanent link">&para;</a></h4>
<p>When run with the <code>-S</code> or <code>-SP</code> argument, the <code>ctest</code> executable runs the script that configures the dashboard mode. The <code>-SP</code> mode only differs in that it runs the script in a new process.</p>
<p>The script has to manage all the dashboard mode phases. For each phase, there is a corresponding command <code>cmake_&lt;phase&gt;</code> that has to be called. The commands are:</p>
<ul>
<li><a href="https://cmake.org/cmake/help/latest/command/ctest_start.html"><code>ctest_start</code></a>: Initializes the dashboard mode. The only required parameter is a positional parameter mode or model, which is one of the following:<ul>
<li><code>Continuous</code>: for continuous integration</li>
<li><code>Nightly</code>: for nightly builds</li>
<li><code>Experimental</code>: for local testing</li>
</ul>
</li>
<li><a href="https://cmake.org/cmake/help/latest/command/ctest_update.html"><code>ctest_update</code></a>: Updates the source code from version control (Git, SVN, etc.)<ul>
<li>optional phase</li>
</ul>
</li>
<li><a href="https://cmake.org/cmake/help/latest/command/ctest_configure.html"><code>ctest_configure</code></a>: Configures the project</li>
<li><a href="https://cmake.org/cmake/help/latest/command/ctest_build.html"><code>ctest_build</code></a>: Builds the project<ul>
<li>optional phase</li>
</ul>
</li>
<li><a href="https://cmake.org/cmake/help/latest/command/ctest_test.html"><code>ctest_test</code></a>: Runs the tests</li>
<li><a href="https://cmake.org/cmake/help/latest/command/ctest_coverage.html"><code>ctest_coverage</code></a>: Collects the coverage information<ul>
<li>optional phase</li>
</ul>
</li>
<li><a href="https://cmake.org/cmake/help/latest/command/ctest_memcheck.html"><code>ctest_memcheck</code></a>: Runs the memory check<ul>
<li>optional phase</li>
</ul>
</li>
<li><a href="https://cmake.org/cmake/help/latest/command/ctest_submit.html"><code>ctest_submit</code></a>: Submits the results to the CDash server</li>
</ul>
<p>The above commands depend on some cmake variables (some of them can be replaced by additional arguments of the command):</p>
<ul>
<li><code>CTEST_SOURCE_DIRECTORY</code>: the source directory of the project (the directory where the <code>CMakeLists.txt</code> file is located)</li>
<li><code>CTEST_BINARY_DIRECTORY</code>: the build directory of the project</li>
<li><code>CTEST_CONFIGURE_COMMAND</code>: the command that configures the project. Typically <code>cmake</code> command with some arguments.</li>
<li><code>CTEST_BUILD_COMMAND</code>: the command that builds the project. Typically <code>cmake --build</code> command with some arguments.</li>
</ul>
<h4 id="configuring-the-dashboard">Configuring the Dashboard<a class="headerlink" href="#configuring-the-dashboard" title="Permanent link">&para;</a></h4>
<p>To see the results of the process in a nice GUI, we need a project on a CDash server. We can either use the public CDash server or set up our own server. </p>
<p>To use the public CDash server, we have to:</p>
<ol>
<li>create an account on the <a href="https://my.cdash.org">CDash server</a></li>
<li>create a project on the server</li>
<li>download the <code>CTestConfig.cmake</code> file from the project page and put it in the project directory (the directory where the <code>CMakeLists.txt</code> file is located)</li>
</ol>
<h2 id="problems">Problems<a class="headerlink" href="#problems" title="Permanent link">&para;</a></h2>
<h4 id="warning-name-library-version-mismatched-error"><code>Warning! &lt;name&gt; library version mismatched error</code><a class="headerlink" href="#warning-name-library-version-mismatched-error" title="Permanent link">&para;</a></h4>
<p>This error typically occures when the library <code>&lt;name&gt;</code> used during the build is different from the library used at runtime when running the tests. This can happen due to following scenario:</p>
<ol>
<li>The library relies on the <code>PATH</code> variable to find the library at runtime, but the path used during the build is specified manually.</li>
<li>There is another library with the same name earlier in the <code>PATH</code> variable, and the version differs.</li>
</ol>
<p>The solution is:</p>
<ol>
<li>Identify the path used incorrectly at runtime</li>
<li>Move the problematic path after the correct path in the <code>PATH</code> variable</li>
</ol>
<p>The identification step can be hard here, as the ctest does not report the real path to the library used at runtime, but the path where this library was compiled. In other words, the <code>Installation point</code> under the <code>General Information</code> is incorrect. </p>
<p>The identification of the real path to the problematic library can be done as follows:</p>
<ol>
<li>build the tests manually using CMake</li>
<li>run a single test in the debugger and break</li>
<li>open the Process Explorer</li>
<li><code>View</code> -&gt; <code>Lower Pane View</code> -&gt; <code>DLLs</code></li>
<li>click on the test process</li>
<li>In the Lower Pane View, there is a list of all DLLs loaded by the test process. Find the problematic library and check the path to it.</li>
</ol>
<h2 id="test-fixtures">Test fixtures<a class="headerlink" href="#test-fixtures" title="Permanent link">&para;</a></h2>
<p>In CMake, there is no dirrect suppor for fixtures as we know them from other testing frameworks. Instead, we define the setup and teardown code as separate tests and then, we use a <code>set_tests_properties</code> command to set up the dependencies between the tests. Example:</p>
<pre><code class="language-cmake">add_test(NAME setup COMMAND &lt;setup command&gt;)
add_test(NAME test1 COMMAND &lt;test 1 command&gt;)
add_test(NAME test2 COMMAND &lt;test 2 command&gt;)
add_test(NAME teardown COMMAND &lt;teardown command&gt;)

set_tests_properties(test1, test2 PROPERTIES FIXTURES_REQUIRED my_test_suite)
set_tests_properties(setup PROPERTIES FIXTURES_SETUP my_test_suite)
set_tests_properties(teardown PROPERTIES FIXTURES_CLEANUP my_test_suite)
</code></pre>
<h2 id="running-tests-not-related-to-any-cmake-project">Running tests not related to any CMake project<a class="headerlink" href="#running-tests-not-related-to-any-cmake-project" title="Permanent link">&para;</a></h2>
<p>There is no way how to run tests that are not related to any CMake project directly using the <code>ctest</code> command, and we cannot add such tests in the ctest starter script. The minimal solution is to:</p>
<ul>
<li>create a dummy CMake project that only contains the tests (no targets, etc.)</li>
<li>skip the build step in the ctest starter script</li>
<li>run the tests starter normally using the <code>ctest</code> command</li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../js/base.js" defer></script>
        <script src="../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
