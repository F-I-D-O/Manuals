<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>Database Workflow - Manuals</title>
        <link href="../../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">
        <link href="../../../extra.css" rel="stylesheet">

        <script src="../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../..">Manuals</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Programming <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">C++</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../C%2B%2B/C%2B%2B%20Debugging%20and%20Profiling/" class="dropdown-item">C++ Debugging and Profiling</a>
</li>
            
<li>
    <a href="../../C%2B%2B/C%2B%2B%20Manual/" class="dropdown-item">C++ Manual</a>
</li>
            
<li>
    <a href="../../C%2B%2B/C%2B%2B%20Workflow/" class="dropdown-item">C++ Workflow</a>
</li>
            
<li>
    <a href="../../C%2B%2B/CMake%20Manual/" class="dropdown-item">CMake Manual</a>
</li>
            
<li>
    <a href="../../C%2B%2B/Google%20Test/" class="dropdown-item">Google Test</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Database</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="./" class="dropdown-item active">Database Workflow</a>
</li>
            
<li>
    <a href="../PostgreSQL%20Debugging%20and%20Profiling/" class="dropdown-item">PostgreSQL Debugging and Profiling</a>
</li>
            
<li>
    <a href="../PostgreSQL%20Manual/" class="dropdown-item">PostgreSQL Manual</a>
</li>
            
<li>
    <a href="../SQL%20Manual/" class="dropdown-item">SQL Manual</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Java</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../Java/Debugging%20Java/" class="dropdown-item">Debugging Java</a>
</li>
            
<li>
    <a href="../../Java/Jackson/" class="dropdown-item">Jackson</a>
</li>
            
<li>
    <a href="../../Java/Java%20Manual/" class="dropdown-item">Java Manual</a>
</li>
            
<li>
    <a href="../../Java/Java%20Workflow/" class="dropdown-item">Java Workflow</a>
</li>
            
<li>
    <a href="../../Java/Maven/" class="dropdown-item">Maven</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Python</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../Python/Matplotlib%20Manual/" class="dropdown-item">Matplotlib Manual</a>
</li>
            
<li>
    <a href="../../Python/Pandas%20Manual/" class="dropdown-item">Pandas Manual</a>
</li>
            
<li>
    <a href="../../Python/Plotly%20Manual/" class="dropdown-item">Plotly Manual</a>
</li>
            
<li>
    <a href="../../Python/Python%20Debugging/" class="dropdown-item">Python Debugging</a>
</li>
            
<li>
    <a href="../../Python/Python%20Manual/" class="dropdown-item">Python Manual</a>
</li>
            
<li>
    <a href="../../Python/Python%20Workflow/" class="dropdown-item">Python Workflow</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Web</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../Web/CSS%20Manual/" class="dropdown-item">CSS Manual</a>
</li>
            
<li>
    <a href="../../Web/css/" class="dropdown-item">css</a>
</li>
            
<li>
    <a href="../../Web/Google%20API%20and%20Apps%20Script/" class="dropdown-item">Google API and Apps Script</a>
</li>
            
<li>
    <a href="../../Web/htaccess/" class="dropdown-item">htaccess</a>
</li>
            
<li>
    <a href="../../Web/JavaScript/" class="dropdown-item">JavaScript</a>
</li>
            
<li>
    <a href="../../Web/Jekyll/" class="dropdown-item">Jekyll</a>
</li>
            
<li>
    <a href="../../Web/mkdocs/" class="dropdown-item">mkdocs</a>
</li>
    </ul>
  </li>
                                    
<li>
    <a href="../../Common/" class="dropdown-item">Common</a>
</li>
                                    
<li>
    <a href="../../Git/" class="dropdown-item">Git</a>
</li>
                                    
<li>
    <a href="../../Gurobi/" class="dropdown-item">Gurobi</a>
</li>
                                    
<li>
    <a href="../../HDF/" class="dropdown-item">HDF</a>
</li>
                                    
<li>
    <a href="../../JSON/" class="dropdown-item">JSON</a>
</li>
                                    
<li>
    <a href="../../Native%20Libraries/" class="dropdown-item">Native Libraries</a>
</li>
                                    
<li>
    <a href="../../Perl/" class="dropdown-item">Perl</a>
</li>
                                    
<li>
    <a href="../../Regex/" class="dropdown-item">Regex</a>
</li>
                                    
<li>
    <a href="../../Ruby%20Workflow/" class="dropdown-item">Ruby Workflow</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">LaTeX <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../LaTeX/Latex%20manual/" class="dropdown-item">Latex manual</a>
</li>
                                    
<li>
    <a href="../../../LaTeX/LaTeX%20workflow/" class="dropdown-item">LaTeX workflow</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../../../Ubuntu" class="nav-link">Ubuntu</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Windows <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../Windows/Excel%20Manual/" class="dropdown-item">Excel Manual</a>
</li>
                                    
<li>
    <a href="../../../Windows/PowerPoint/" class="dropdown-item">PowerPoint</a>
</li>
                                    
<li>
    <a href="../../../Windows/Powershell%20Manual/" class="dropdown-item">Powershell Manual</a>
</li>
                                    
<li>
    <a href="../../../Windows/VSCode/" class="dropdown-item">VSCode</a>
</li>
                                    
<li>
    <a href="../../../Windows/Windows%20Manual/" class="dropdown-item">Windows Manual</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Audio & Video <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../Audio%20%26%20Video/FFMpeg/" class="dropdown-item">FFMpeg</a>
</li>
                                    
<li>
    <a href="../../../Audio%20%26%20Video/VLC/" class="dropdown-item">VLC</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Cloud computing <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../Cloud%20computing/Lmod/" class="dropdown-item">Lmod</a>
</li>
                                    
<li>
    <a href="../../../Cloud%20computing/RCI%20cluster/" class="dropdown-item">RCI cluster</a>
</li>
                                    
<li>
    <a href="../../../Cloud%20computing/Slurm/" class="dropdown-item">Slurm</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">GIS <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../GIS/GIS%20formats/" class="dropdown-item">GIS formats</a>
</li>
                                    
<li>
    <a href="../../../GIS/Overpass%20Manual/" class="dropdown-item">Overpass Manual</a>
</li>
                                    
<li>
    <a href="../../../GIS/QGIS/" class="dropdown-item">QGIS</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Images <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../Images/Midjourney/" class="dropdown-item">Midjourney</a>
</li>
                                    
<li>
    <a href="../../../Images/Photopea/" class="dropdown-item">Photopea</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Linux <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../Linux/Linux%20Manual/" class="dropdown-item">Linux Manual</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../../../Arxiv/" class="nav-link">Arxiv</a>
                            </li>
                            <li class="navitem">
                                <a href="../../../Google%20office%20apps/" class="nav-link">Google office apps</a>
                            </li>
                            <li class="navitem">
                                <a href="../../.." class="nav-link">index</a>
                            </li>
                            <li class="navitem">
                                <a href="../../../Markdown/" class="nav-link">Markdown</a>
                            </li>
                            <li class="navitem">
                                <a href="../../../Network/" class="nav-link">Network</a>
                            </li>
                            <li class="navitem">
                                <a href="../../../Security/" class="nav-link">Security</a>
                            </li>
                            <li class="navitem">
                                <a href="../../../vscode/" class="nav-link">vscode</a>
                            </li>
                            <li class="navitem">
                                <a href="../../../Web%20Tricks/" class="nav-link">Web Tricks</a>
                            </li>
                            <li class="navitem">
                                <a href="../../../YAML/" class="nav-link">YAML</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../../C%2B%2B/Google%20Test/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../PostgreSQL%20Debugging%20and%20Profiling/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#datagrip" class="nav-link">DataGrip</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#import-formats" class="nav-link">Import Formats</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#view-geometry" class="nav-link">View Geometry</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#create-a-spatial-index" class="nav-link">Create a spatial Index</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#filter-out-store-procedures" class="nav-link">Filter out store procedures</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#creating-functions-and-procedures" class="nav-link">Creating functions and procedures</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#duplicate-table" class="nav-link">Duplicate table</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#known-issues-and-workarounds" class="nav-link">Known issues and workarounds</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#cannot-delete-a-database-due-to-datagrips-own-connections" class="nav-link">Cannot delete a database due to DataGrip's own connections</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#datagrip-displays-objects-that-were-deleted" class="nav-link">DataGrip displays objects that were deleted</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#navicat" class="nav-link">Navicat</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#cannot-connect-to-db" class="nav-link">Cannot connect to db</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#pgadmin" class="nav-link">PgAdmin</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#diagrams" class="nav-link">Diagrams</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#postgresql" class="nav-link">PostgreSQL</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#starting-stopping-and-restarting-the-cluster" class="nav-link">Starting, stopping, and restarting the cluster</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#monitoring-activity" class="nav-link">Monitoring activity</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#pg_stat_activity" class="nav-link">pg_stat_activity</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#kill-a-hanging-query" class="nav-link">Kill a hanging query</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#creating-new-user" class="nav-link">Creating new user</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#deleting-database" class="nav-link">Deleting database</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#granting-privileges" class="nav-link">Granting privileges</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#grant-privileges-for-a-database" class="nav-link">Grant privileges for a database</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#grant-privileges-for-database-schema" class="nav-link">Grant privileges for database schema</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#upgrading-the-database-cluster" class="nav-link">Upgrading the database cluster</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#upgrading-extensions" class="nav-link">Upgrading extensions</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#managing-access-to-the-database" class="nav-link">Managing access to the database</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#lost-password-to-the-postgres-server" class="nav-link">Lost Password to the Postgres Server</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#configuration" class="nav-link">Configuration</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#configuration-with-postgresqlconf" class="nav-link">Configuration with postgresql.conf</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#getting-and-setting-parameters-at-runtime-using-sql" class="nav-link">Getting and setting parameters at runtime using SQL</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#logging" class="nav-link">Logging</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#garbage-collection-and-optimization" class="nav-link">Garbage collection and optimization</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="datagrip">DataGrip<a class="headerlink" href="#datagrip" title="Permanent link">&para;</a></h1>
<h2 id="import-formats">Import Formats<a class="headerlink" href="#import-formats" title="Permanent link">&para;</a></h2>
<p>DataGrip can handle imports only from separator baset files (csv, tsv).</p>
<h2 id="view-geometry">View Geometry<a class="headerlink" href="#view-geometry" title="Permanent link">&para;</a></h2>
<p>In the reuslt window/tab, click on the gear wheel -&gt; <code>Show GeoView</code>. However, the <strong>geoviewer has a fixed WGS84 projection, so you have to project the result to this projection first</strong>.</p>
<h2 id="create-a-spatial-index">Create a spatial Index<a class="headerlink" href="#create-a-spatial-index" title="Permanent link">&para;</a></h2>
<p>There is currently no GUI tool for that in DataGrip. Just add a normal index and modify the auto generated statement by changing <code>&lt;column&gt;</code> to <code>USING GIST(&lt;column&gt;)</code> at the end of the statement.</p>
<h2 id="filter-out-store-procedures">Filter out store procedures<a class="headerlink" href="#filter-out-store-procedures" title="Permanent link">&para;</a></h2>
<ol>
<li>right-click on <code>routines</code></li>
<li>click <code>open table</code></li>
<li>sort by type</li>
</ol>
<h2 id="creating-functions-and-procedures">Creating functions and procedures<a class="headerlink" href="#creating-functions-and-procedures" title="Permanent link">&para;</a></h2>
<p>There is no UI available currently, use Navicat or console</p>
<h2 id="duplicate-table">Duplicate table<a class="headerlink" href="#duplicate-table" title="Permanent link">&para;</a></h2>
<p>Drag the table in the database explorer and drop it to the location you want it to copy to.</p>
<h2 id="known-issues-and-workarounds">Known issues and workarounds<a class="headerlink" href="#known-issues-and-workarounds" title="Permanent link">&para;</a></h2>
<h2 id="cannot-delete-a-database-due-to-datagrips-own-connections">Cannot delete a database due to DataGrip's own connections<a class="headerlink" href="#cannot-delete-a-database-due-to-datagrips-own-connections" title="Permanent link">&para;</a></h2>
<p>Before deleting a database we need to close all DataGrip sessions connected to the database. We can do that in the sessions window.</p>
<h3 id="datagrip-displays-objects-that-were-deleted">DataGrip displays objects that were deleted<a class="headerlink" href="#datagrip-displays-objects-that-were-deleted" title="Permanent link">&para;</a></h3>
<p>Sometimes, DataGrip displays objects that were deleted. Additionally, it it displays errors when trying to refresh the view. Solution:</p>
<ol>
<li>right-click on database connection (root object in the database explorer)</li>
<li>click on <code>Diagnostics</code> -&gt; <code>Force refresh</code></li>
</ol>
<h1 id="navicat">Navicat<a class="headerlink" href="#navicat" title="Permanent link">&para;</a></h1>
<h2 id="cannot-connect-to-db">Cannot connect to db<a class="headerlink" href="#cannot-connect-to-db" title="Permanent link">&para;</a></h2>
<p>Symptoms:</p>
<ul>
<li>cant connect to db server: <code>Could not connect</code></li>
<li>after editing the connection and trying to save it (ok button): <code>connection is being used</code></li>
</ul>
<p>Try:</p>
<ol>
<li>close navicat</li>
<li>open navicat, edit connection</li>
<li>click test connection</li>
<li>click ok, and start the connection by double click</li>
</ol>
<h1 id="pgadmin">PgAdmin<a class="headerlink" href="#pgadmin" title="Permanent link">&para;</a></h1>
<p>The best way to install the PgAdmin is to use the <a href="https://www.postgresql.org/download/windows/">EDB PostgreSQL installer</a> and uncheck the database installation during the installation configuration. This way, we also install useful tools like <code>psql</code></p>
<h2 id="diagrams">Diagrams<a class="headerlink" href="#diagrams" title="Permanent link">&para;</a></h2>
<p>To create diagram from an existing database: right click on the database -&gt; <code>Generate ERD</code></p>
<h1 id="postgresql">PostgreSQL<a class="headerlink" href="#postgresql" title="Permanent link">&para;</a></h1>
<p>As a first step, it is always good to know which clusters are installed and running. To show this information, use the <code>pg_lsclusters</code> command.</p>
<h2 id="starting-stopping-and-restarting-the-cluster">Starting, stopping, and restarting the cluster<a class="headerlink" href="#starting-stopping-and-restarting-the-cluster" title="Permanent link">&para;</a></h2>
<p>Sometimes it is needed to restart the cluster. There are two commands:</p>
<ul>
<li><code>pg_ctl restart</code>: restarts the cluster</li>
<li><code>pg_ctl reload</code>: reloads the configuration of the cluster</li>
</ul>
<p>Always check which one is needed in each case. For both commands, the path to the <code>data</code> directory of the cluster is needed. We can specify it in two ways:</p>
<ul>
<li>using the <code>-D</code> parameter of the <code>pg_ctl</code> command</li>
<li>setting the <code>PGDATA</code> environment variable</li>
</ul>
<h2 id="monitoring-activity">Monitoring activity<a class="headerlink" href="#monitoring-activity" title="Permanent link">&para;</a></h2>
<p>To monitor the activity on Linux, we can use the <a href="https://github.com/dalibo/pg_activity"><code>pg_activity</code></a>:</p>
<pre><code class="language-bash">sudo -u postgres pg_activity -U postgres
</code></pre>
<p>For a detailed monitoring on all platforms, we can use the <em><a href="https://www.postgresql.org/docs/current/monitoring-stats.html">Cumulative Statistics System</a></em>. It contains collections of statistics that can be accessed similarly to tables. The difference is that these collections are server-wide and can be accessed from any database or scheme. Important collections:</p>
<ul>
<li><a href="https://www.postgresql.org/docs/current/monitoring-stats.html#MONITORING-PG-STAT-ACTIVITY-VIEW"><code>pg_stat_activity</code></a>: contains information about the current activity on the server</li>
</ul>
<h3 id="pg_stat_activity"><code>pg_stat_activity</code><a class="headerlink" href="#pg_stat_activity" title="Permanent link">&para;</a></h3>
<p>The <code>pg_stat_activity</code> collection contains information about the current activity on the server. Some activities belong to background processes it is therefore best to query the collection like:</p>
<pre><code class="language-SQL">SELECT * FROM pg_stat_activity WHERE state IS NOT NULL;
</code></pre>
<h2 id="kill-a-hanging-query">Kill a hanging query<a class="headerlink" href="#kill-a-hanging-query" title="Permanent link">&para;</a></h2>
<p>To kill the query, run:</p>
<pre><code class="language-sql">SELECT pg_cancel_backend(&lt;PID&gt;)
</code></pre>
<p>The <code>PID</code> can be obtained from the <a href="#monitoring-activity">database activity monitoring tool</a>.</p>
<h2 id="creating-new-user">Creating new user<a class="headerlink" href="#creating-new-user" title="Permanent link">&para;</a></h2>
<p>For creating a new user, we can use the <a href="https://www.postgresql.org/docs/current/app-createuser.html"><code>createuser</code></a> command. Important parameters:</p>
<ul>
<li><code>-P</code> or <code>--pwprompt</code>: prompt for password. If not used, the user will be created without a password.</li>
</ul>
<h2 id="deleting-database">Deleting database<a class="headerlink" href="#deleting-database" title="Permanent link">&para;</a></h2>
<p>To delete a database, we can use the <a href="https://www.postgresql.org/docs/current/app-dropdb.html"><code>dropdb</code></a> command: <code>dropdb &lt;db name&gt;</code></p>
<h2 id="granting-privileges">Granting privileges<a class="headerlink" href="#granting-privileges" title="Permanent link">&para;</a></h2>
<h3 id="grant-privileges-for-a-database">Grant privileges for a database<a class="headerlink" href="#grant-privileges-for-a-database" title="Permanent link">&para;</a></h3>
<p>To give privileges for creating new tables and other objects in a database:</p>
<pre><code class="language-SQL">GRANT ALL PRIVILEGES ON DATABASE &lt;db name&gt; TO &lt;user name&gt;;
</code></pre>
<p>To give privileges for existing objects, it is best to change the owner of the objects.</p>
<h3 id="grant-privileges-for-database-schema">Grant privileges for database schema<a class="headerlink" href="#grant-privileges-for-database-schema" title="Permanent link">&para;</a></h3>
<p>To grant all privileges for a database schema to a user, we can use the following command:</p>
<pre><code class="language-SQL">GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO &lt;user name&gt;;
</code></pre>
<p>To grant only the <code>SELECT</code> privilege, use:</p>
<pre><code class="language-SQL">GRANT SELECT ON ALL TABLES IN SCHEMA public TO &lt;user name&gt;;
</code></pre>
<h2 id="upgrading-the-database-cluster">Upgrading the database cluster<a class="headerlink" href="#upgrading-the-database-cluster" title="Permanent link">&para;</a></h2>
<p>With PostgreSQL version 9.3 and later, we can upgrade easily even between major versions using the <a href="https://www.postgresql.org/docs/current/pgupgrade.html"><code>pg_upgrade</code></a> command. We can even skip versions, e.g., upgrade from 12 to 16. </p>
<p>The process is described in the pg_upgrade manual, however, usually, most of the steps are not necessary as they apply only to very specific cases. On top of that, some aspects important for the upgrade are not mentioned in the manual.</p>
<p>The steps for a typical ubuntu/debian installation are:</p>
<ol>
<li>stop the new cluster using <code>systemctl stop postgresql@&lt;version&gt;-main</code></li>
<li>run the <code>pg_upgrade</code> command with <code>--check</code> to check the compatibility</li>
<li>stop the old cluster using <code>systemctl stop postgresql</code></li>
<li>run the <code>pg_upgrade</code> command without <code>--check</code> to perform the upgrade</li>
<li>apply all actions recommended by the <code>pg_upgrade</code> output</li>
<li>change the <code>port</code> in the <code>/etc/postgresql/&lt;version&gt;/main/postgresql.conf</code> file of the new cluster to the original port (usually 5432)</li>
<li>start the new cluster using <code>systemctl start postgresql@&lt;version&gt;-main</code> an check if the connection works</li>
</ol>
<p>The standard <code>pg_upgrade</code> command looks like this:</p>
<pre><code class="language-bash">sudo -u postgres pg_upgrade --link -j &lt;number of cores&gt; -b &lt;old bin dir&gt; -d &lt;old data dir&gt; -D &lt;new data dir&gt; -o 'config_file=&lt;old conf file&gt;' -O 'config_file=&lt;new conf file&gt;'
</code></pre>
<p>Description:</p>
<ul>
<li><code>--link</code>: links the old data directory to the new one instead of copying the data. Fastest migration method.</li>
<li><code>&lt;old bin dir&gt;</code>: The <code>bin</code> directory of the old cluster.<ul>
<li>usually <code>/usr/lib/postgresql/&lt;old version&gt;/bin</code></li>
</ul>
</li>
<li><code>&lt;old/new data dir&gt;</code>: The <code>data</code> directory of the cluster.<ul>
<li>usually <code>/var/lib/postgresql/&lt;old/new version&gt;/main</code>.</li>
<li>Can be found using <code>pg_lsclusters</code></li>
</ul>
</li>
<li><code>&lt;old/new conf file&gt;</code>: The path to the <code>postgresql.conf</code> file.<ul>
<li>usually <code>/etc/postgresql/&lt;old/new version&gt;/main/postgresql.conf</code></li>
</ul>
</li>
</ul>
<h2 id="upgrading-extensions">Upgrading extensions<a class="headerlink" href="#upgrading-extensions" title="Permanent link">&para;</a></h2>
<p>Some PostgreSQL extensions uses separate libraries. These are installed fro each version of the PostgreSQL server separately. If a library is not foun on the new cluster, it is detected by the <code>pg_upgrade</code> command automaticly. In that case, you have to install the library according to the instructions of the library provider.</p>
<h2 id="managing-access-to-the-database">Managing access to the database<a class="headerlink" href="#managing-access-to-the-database" title="Permanent link">&para;</a></h2>
<p>To manage access to the database, we can use the <code>pg_hba.conf</code> file. </p>
<p>This file is located in the <code>data</code> directory of the PostgreSQL installation. Unfortunately, the location of the <code>data</code> directory is not standardized, and the variants are many. However, there is a remedy, just execute the following SQL command:</p>
<pre><code class="language-SQL">SHOW hba_file
</code></pre>
<p><a href="https://www.postgresql.org/docs/current/auth-pg-hba-conf.html">Documentation</a></p>
<h3 id="lost-password-to-the-postgres-server">Lost Password to the Postgres Server<a class="headerlink" href="#lost-password-to-the-postgres-server" title="Permanent link">&para;</a></h3>
<p>The password for the db superuser is stored in db <code>postgres</code>. In order to log there and change it, the whole authentification has to be turned off, and then we can proceed with changing the password. Steps:</p>
<ol>
<li>find the <code>pg_hba.conf file</code> <ul>
<li>usually located in <code>C:\Program Files\PostgreSQL\13\data</code></li>
</ul>
</li>
<li>backup the file and replace all occurances of <code>scram-sha-256</code> in the file with <code>trust</code></li>
<li>restart the posgreSQL service<ul>
<li>in the Windows service management, there should be a service for postgresql running</li>
</ul>
</li>
<li>change the password for the superuser<ol>
<li><code>psql -U postgres</code></li>
<li><code>ALTER USER postgres WITH password 'yourpassword';</code> (do not forget the semicolon at the end!)</li>
</ol>
</li>
<li>restore the <code>pg_hba.conf</code> file from backup</li>
<li>restart the postgreSQL service again</li>
<li>test if the new password works</li>
</ol>
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h2>
<p><a href="https://www.postgresql.org/docs/current/config-setting.html">Documentation</a></p>
<p>PostgreSQL server can be configured using <em>parameters</em>. The parameters itself can be set in multiple ways:</p>
<ul>
<li>default values are set in the configuration file stored in the <code>&lt;postgres data dir&gt;/postgresql.conf</code>.</li>
<li>the values can be set at runtime using SQL</li>
<li>the values can be set at runtime using shell commands</li>
</ul>
<h3 id="configuration-with-postgresqlconf">Configuration with <code>postgresql.conf</code><a class="headerlink" href="#configuration-with-postgresqlconf" title="Permanent link">&para;</a></h3>
<p>all the properties are there, we typically just need to uncomment them. </p>
<p>Be awere of these syntactic rules:</p>
<ul>
<li>the <code>#</code> character is used for comments</li>
<li>for directonary paths, use <code>/</code> as the path separator, never use <code>\</code></li>
<li>wrap paths in single quotes, not double quotes</li>
</ul>
<h3 id="getting-and-setting-parameters-at-runtime-using-sql">Getting and setting parameters at runtime using SQL<a class="headerlink" href="#getting-and-setting-parameters-at-runtime-using-sql" title="Permanent link">&para;</a></h3>
<p>to get the value of a parameter, we can use the <a href="https://www.postgresql.org/docs/current/sql-show.html"><code>SHOW</code></a> command or the <code>current_setting</code> function:</p>
<pre><code class="language-PostgreSQL">SHOW &lt;parameter name&gt;;
SELECT current_setting('&lt;parameter name&gt;');
</code></pre>
<p>To set the value of a parameter, we can use the <a href="https://www.postgresql.org/docs/current/sql-set.html"><code>SET</code></a> command or the <code>set_config</code> function:</p>
<pre><code class="language-PostgreSQL">SET &lt;parameter name&gt; TO &lt;value&gt;;
SELECT set_config('&lt;parameter name&gt;', '&lt;value&gt;', false);
</code></pre>
<p>If the third parameter of the <code>set_config</code> function is set to <code>true</code>, the value is set for the current transaction only.</p>
<h3 id="logging">Logging<a class="headerlink" href="#logging" title="Permanent link">&para;</a></h3>
<p><a href="https://www.postgresql.org/docs/current/runtime-config-logging.html">Documentation</a></p>
<p>The logs are stored in the <code>&lt;postgres data dir&gt;/log</code> directory. </p>
<p>By default, only errors are logged. To logg statements, we need to change the <code>log_statement</code> parameter. Valid values are:</p>
<ul>
<li><code>none</code>: no statements are logged</li>
<li><code>ddl</code>: only DDL statements are logged</li>
<li><code>mod</code>: only statements that modify the database are logged</li>
<li><code>all</code>: all statements are logged</li>
</ul>
<h2 id="garbage-collection-and-optimization">Garbage collection and optimization<a class="headerlink" href="#garbage-collection-and-optimization" title="Permanent link">&para;</a></h2>
<p>There is a shared command for both garbage collection (vacuum) and optimization (analyze) of the database. To execute it from the command line, use the <a href="https://www.postgresql.org/docs/current/app-vacuumdb.html">vacuumdb`</a> command.  </p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../js/base.js" defer></script>
        <script src="../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
