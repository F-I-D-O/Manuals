<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Security - Manuals</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
        <link href="../extra.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Manuals</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Programming <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">C++</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../Programming/C%2B%2B/C%2B%2B%20Debugging%20and%20Profiling/" class="dropdown-item">C++ Debugging and Profiling</a>
</li>
            
<li>
    <a href="../Programming/C%2B%2B/C%2B%2B%20Manual/" class="dropdown-item">C++ Manual</a>
</li>
            
<li>
    <a href="../Programming/C%2B%2B/C%2B%2B%20Workflow/" class="dropdown-item">C++ Workflow</a>
</li>
            
<li>
    <a href="../Programming/C%2B%2B/CMake%20Manual/" class="dropdown-item">CMake Manual</a>
</li>
            
<li>
    <a href="../Programming/C%2B%2B/Google%20Test/" class="dropdown-item">Google Test</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Java</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../Programming/Java/Debugging%20Java/" class="dropdown-item">Debugging Java</a>
</li>
            
<li>
    <a href="../Programming/Java/Jackson/" class="dropdown-item">Jackson</a>
</li>
            
<li>
    <a href="../Programming/Java/Java%20Programming%20Guide/" class="dropdown-item">Java Programming Guide</a>
</li>
            
<li>
    <a href="../Programming/Java/Java%20Workflow/" class="dropdown-item">Java Workflow</a>
</li>
            
<li>
    <a href="../Programming/Java/Maven/" class="dropdown-item">Maven</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Python</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../Programming/Python/Matplotlib%20Manual/" class="dropdown-item">Matplotlib Manual</a>
</li>
            
<li>
    <a href="../Programming/Python/Pandas%20Manual/" class="dropdown-item">Pandas Manual</a>
</li>
            
<li>
    <a href="../Programming/Python/Plotly%20Manual/" class="dropdown-item">Plotly Manual</a>
</li>
            
<li>
    <a href="../Programming/Python/Python%20Debugging/" class="dropdown-item">Python Debugging</a>
</li>
            
<li>
    <a href="../Programming/Python/Python%20Manual/" class="dropdown-item">Python Manual</a>
</li>
            
<li>
    <a href="../Programming/Python/Python%20Workflow/" class="dropdown-item">Python Workflow</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Web</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../Programming/Web/CSS%20Manual/" class="dropdown-item">CSS Manual</a>
</li>
            
<li>
    <a href="../Programming/Web/css/" class="dropdown-item">css</a>
</li>
            
<li>
    <a href="../Programming/Web/Google%20API%20and%20Apps%20Script/" class="dropdown-item">Google API and Apps Script</a>
</li>
            
<li>
    <a href="../Programming/Web/htaccess/" class="dropdown-item">htaccess</a>
</li>
            
<li>
    <a href="../Programming/Web/JavaScript/" class="dropdown-item">JavaScript</a>
</li>
            
<li>
    <a href="../Programming/Web/Jekyll/" class="dropdown-item">Jekyll</a>
</li>
            
<li>
    <a href="../Programming/Web/mkdocs/" class="dropdown-item">mkdocs</a>
</li>
    </ul>
  </li>
                                    
<li>
    <a href="../Programming/Common/" class="dropdown-item">Common</a>
</li>
                                    
<li>
    <a href="../Programming/Git/" class="dropdown-item">Git</a>
</li>
                                    
<li>
    <a href="../Programming/Gurobi/" class="dropdown-item">Gurobi</a>
</li>
                                    
<li>
    <a href="../Programming/HDF/" class="dropdown-item">HDF</a>
</li>
                                    
<li>
    <a href="../Programming/JSON/" class="dropdown-item">JSON</a>
</li>
                                    
<li>
    <a href="../Programming/Native%20Libraries/" class="dropdown-item">Native Libraries</a>
</li>
                                    
<li>
    <a href="../Programming/PostgreSQL%20Manual/" class="dropdown-item">PostgreSQL Manual</a>
</li>
                                    
<li>
    <a href="../Programming/Regex/" class="dropdown-item">Regex</a>
</li>
                                    
<li>
    <a href="../Programming/Ruby%20Workflow/" class="dropdown-item">Ruby Workflow</a>
</li>
                                    
<li>
    <a href="../Programming/SQL%20Manual/" class="dropdown-item">SQL Manual</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">LaTeX <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../LaTeX/Latex%20manual/" class="dropdown-item">Latex manual</a>
</li>
                                    
<li>
    <a href="../LaTeX/LaTeX%20workflow/" class="dropdown-item">LaTeX workflow</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Ubuntu <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../Ubuntu/Linux%20Manual/" class="dropdown-item">Linux Manual</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Windows <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../Windows/Excel%20Manual/" class="dropdown-item">Excel Manual</a>
</li>
                                    
<li>
    <a href="../Windows/PowerPoint/" class="dropdown-item">PowerPoint</a>
</li>
                                    
<li>
    <a href="../Windows/Powershell%20Manual/" class="dropdown-item">Powershell Manual</a>
</li>
                                    
<li>
    <a href="../Windows/VSCode/" class="dropdown-item">VSCode</a>
</li>
                                    
<li>
    <a href="../Windows/Windows%20Manual/" class="dropdown-item">Windows Manual</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Audio & Video <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../Audio%20%26%20Video/FFMpeg/" class="dropdown-item">FFMpeg</a>
</li>
                                    
<li>
    <a href="../Audio%20%26%20Video/VLC/" class="dropdown-item">VLC</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Cloud computing <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../Cloud%20computing/Lmod/" class="dropdown-item">Lmod</a>
</li>
                                    
<li>
    <a href="../Cloud%20computing/RCI%20cluster/" class="dropdown-item">RCI cluster</a>
</li>
                                    
<li>
    <a href="../Cloud%20computing/Slurm/" class="dropdown-item">Slurm</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">GIS <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../GIS/Overpass%20Manual/" class="dropdown-item">Overpass Manual</a>
</li>
                                    
<li>
    <a href="../GIS/QGIS/" class="dropdown-item">QGIS</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Images <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../Images/Midjourney/" class="dropdown-item">Midjourney</a>
</li>
                                    
<li>
    <a href="../Images/Photopea/" class="dropdown-item">Photopea</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../Arxiv/" class="nav-link">Arxiv</a>
                            </li>
                            <li class="navitem">
                                <a href=".." class="nav-link">index</a>
                            </li>
                            <li class="navitem">
                                <a href="../Markdown/" class="nav-link">Markdown</a>
                            </li>
                            <li class="navitem">
                                <a href="../Network/" class="nav-link">Network</a>
                            </li>
                            <li class="navitem active">
                                <a href="./" class="nav-link">Security</a>
                            </li>
                            <li class="navitem">
                                <a href="../vscode/" class="nav-link">vscode</a>
                            </li>
                            <li class="navitem">
                                <a href="../Web%20Tricks/" class="nav-link">Web Tricks</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../Network/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../vscode/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#ssh" class="nav-link">SSH</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#authentication" class="nav-link">Authentication</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#generating-a-key-pair" class="nav-link">Generating a key pair</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#setting-up-the-private-key-to-be-used-for-ssh-connection" class="nav-link">Setting up the private key to be used for ssh connection</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#ssh-tunneling" class="nav-link">SSH Tunneling</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#debugging-a-ssh-tunnel" class="nav-link">Debugging a SSH tunnel</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#enabnling-ssh-access-on-server" class="nav-link">Enabnling SSH Access on Server</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#enabling-key-authentication-for-a-user" class="nav-link">Enabling key authentication for a user</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#wsl-configuration" class="nav-link">WSL configuration</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#ssh-agent" class="nav-link">SSH Agent</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#starting-the-agent" class="nav-link">Starting the agent</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#listing-keys" class="nav-link">Listing keys</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#adding-keys" class="nav-link">Adding keys</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#debuging" class="nav-link">Debuging</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#configuration" class="nav-link">Configuration</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#known_hosts-file" class="nav-link">known_hosts file</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#screen-executing-a-long-running-process-over-ssh" class="nav-link">Screen: executing a long running process over SSH</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#copying-files-over-ssh-using-scp" class="nav-link">Copying files over SSH using scp</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#problems" class="nav-link">Problems</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#list-all-active-connections-on-a-server" class="nav-link">List all active connections on a server</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#wsl-configuration_1" class="nav-link">WSL configuration</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#debugging" class="nav-link">Debugging</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#gnu-privacy-guard-gpg" class="nav-link">GNU Privacy Guard (GPG)</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#key-expiration" class="nav-link">Key expiration</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#troubleshooting" class="nav-link">Troubleshooting</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#partial-length-invalid-for-packet-type-63" class="nav-link">partial length invalid for packet type 63</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<p>This manual is focused on <a href="https://en.wikipedia.org/wiki/Public-key_cryptography">asymmetric encryption</a>. As the principles are more or less the same for all technologies, we will focus on the technical aspects that differs.</p>
<h1 id="ssh">SSH<a class="headerlink" href="#ssh" title="Permanent link">&para;</a></h1>
<p>The SSH is a protocol for secure communication between two computers. The basic usage is to connect to a remote computer:</p>
<pre><code class="language-bash">ssh &lt;username&gt;@&lt;address&gt;
</code></pre>
<p>To close the connection, type <code>exit</code> to the console and press enter.</p>
<p>If we do not want to establish a connection, but just run a single command, we can add the command at the end of the ssh command:</p>
<pre><code class="language-bash">ssh &lt;username&gt;@&lt;address&gt; &lt;command&gt;
</code></pre>
<h2 id="authentication">Authentication<a class="headerlink" href="#authentication" title="Permanent link">&para;</a></h2>
<p>There are two ways to authenticate to the server:</p>
<ul>
<li>password</li>
<li>private key</li>
</ul>
<p>Note that the server needs to be properly configured to accept your credentials. Specifically:</p>
<ul>
<li>for password authentication, the <code>PasswordAuthentication</code> option in <code>/etc/ssh/sshd_config</code> has to be set to <code>yes</code>. This is often disabled for security reasons.</li>
<li>for private key authentication, the public key has to be added to your user account on the server. </li>
</ul>
<h3 id="generating-a-key-pair">Generating a key pair<a class="headerlink" href="#generating-a-key-pair" title="Permanent link">&para;</a></h3>
<p>To generate a key pair, use the <code>ssh-keygen</code> command.</p>
<h3 id="setting-up-the-private-key-to-be-used-for-ssh-connection">Setting up the private key to be used for ssh connection<a class="headerlink" href="#setting-up-the-private-key-to-be-used-for-ssh-connection" title="Permanent link">&para;</a></h3>
<p>To use a private key for ssh connection, two conditions have to be met:</p>
<ol>
<li>the private key has to have the right permissions:<ul>
<li>in Linux, the permissions have to be read/write only for the owner (<code>600</code>)</li>
</ul>
</li>
<li>you have to specify that the private key should be used for the connection. This can be done in multiple ways:<ul>
<li>using the <code>-i</code> parameter of the <code>ssh</code> command</li>
<li>specifying the key in the <code>~/.ssh/config</code> file</li>
<li>using ssh agent (see the SSH Agent section below)</li>
<li>selecting the key in an application with GUI</li>
</ul>
</li>
</ol>
<h2 id="ssh-tunneling">SSH Tunneling<a class="headerlink" href="#ssh-tunneling" title="Permanent link">&para;</a></h2>
<p>An SSH tunnel can be created by the <code>ssh</code> command. The usuall syntax is following:</p>
<pre><code class="language-bash">ssh -L &lt;local port&gt;:&lt;remote machine&gt;:&lt;remote port&gt; &lt;ssh server username&gt;@&lt;ssh server address&gt;
</code></pre>
<p>The <code>-L</code> argument stands for <em>local port forwarding</em>, i.e., we forward a local port to some remote port.</p>
<p>Example:</p>
<pre><code class="language-bash">ssh -L 1111:localhost:5432 fiedler@its.fel.cvut.cz
</code></pre>
<p>The <em>local port</em> (here <code>1111</code>) is arbitrary, we can use any free port. The aplications using the tunnel should then be configured as:</p>
<ul>
<li>host=<code>localhost</code></li>
<li>port:=<code>1111</code></li>
</ul>
<p>The <em>remote machine</em> is the address of the machine we want to access relative to the <em>ssh server</em>. If the ssh server is running on the computer we want to access through the tunnel, we can use <code>localhost</code>. Analogously, the <em>remote port</em> is the port we wan to use on the remote machine (here <code>5432</code> is a PostgreSQL db port).</p>
<p>The <code>ssh server username</code> and <code>ssh server address</code> are then the username/address of the remote machine. On top of that, we need  password or priveta key to validate our identity. Note that the credential here are the credential for the server, not the credentials of the service we are accessing through the ssh connection. Those credentials has to be usually supplied by the application accessing the service through the ssh tunnel.</p>
<p>The connection can be canceled any time byping <code>exit</code> to the console.</p>
<p><a href="https://linuxize.com/post/how-to-setup-ssh-tunneling/">More information</a></p>
<h3 id="debugging-a-ssh-tunnel">Debugging a SSH tunnel<a class="headerlink" href="#debugging-a-ssh-tunnel" title="Permanent link">&para;</a></h3>
<p>This guide suppose that the tunnel creation comman run without any error message.</p>
<ol>
<li>If the tunnel seems to not work, first use a command line tool to be sure:<ul>
<li>web browser for HTTP tunnels (remote port 80)</li>
<li><code>psql</code> for postgeSQL tunnels (remote port 5432)</li>
<li><code>telnet</code> for telnet tunnels (reote port 23)</li>
</ul>
</li>
<li>If the test is unsucessful, try to kill all ssh connections to the server by shutting down all applications with ssh connections tunnels, untill there will be only one connection at the server (the console). The number of ssh connections can be checked with: <code>sudo netstat -nap | grep :22</code></li>
</ol>
<h2 id="enabnling-ssh-access-on-server">Enabnling SSH Access on Server<a class="headerlink" href="#enabnling-ssh-access-on-server" title="Permanent link">&para;</a></h2>
<ol>
<li>install openssh:<ul>
<li><code>sudo apt update</code></li>
<li><code>sudo apt install openssh-server</code></li>
</ul>
</li>
<li>configure access<ul>
<li>password:<ol>
<li>open <code>/etc/ssh/sshd_config</code></li>
<li>set <code>PasswordAuothentication yes</code></li>
<li>after restrat you can log in with the user and password used in Ubuntu</li>
</ol>
</li>
<li>keys: TODO</li>
</ul>
</li>
<li>restart the ssh server: <code>sudo service ssh restart</code></li>
</ol>
<h3 id="enabling-key-authentication-for-a-user">Enabling key authentication for a user<a class="headerlink" href="#enabling-key-authentication-for-a-user" title="Permanent link">&para;</a></h3>
<p>The user can only use a private key for authentication if the corresponding public key is assigned to the user on server. This is done by adding the public key to the <code>~/.ssh/authorized_keys</code> file. </p>
<p>Note that <strong>the <code>authorized_keys</code> file has to have the right permissions</strong>, which is read/write only for the owner, and read only for the group and others (<code>644</code>).</p>
<h3 id="wsl-configuration">WSL configuration<a class="headerlink" href="#wsl-configuration" title="Permanent link">&para;</a></h3>
<ol>
<li>port <code>22</code> can be used on Windows, so change the port to <code>2222</code> in <code>sshd_config</code></li>
<li>when loging from Windows use <code>127.0.0.1</code> as a host</li>
</ol>
<h2 id="ssh-agent">SSH Agent<a class="headerlink" href="#ssh-agent" title="Permanent link">&para;</a></h2>
<p>Normally, the SSH client process runs only while the SSH session is active, then, it is terminated. That means that we have to reenter the passphrase for the private key every time we want to connect to the server. To overcome this limitation, we can use the SSH agent programe.</p>
<p>An SSH agent is a process for storing decrypted SSH keys in memory. This means that we have to enter the passphrase only once per each OS login. The agent can be configured to automatically run on OS startup. The default SSH agent is <code>ssh-agent</code>, the rest of the section is dedicated to this agent.</p>
<p>To successfully use the agent, we need to:</p>
<ol>
<li>start the agent, either manually or automatically on OS startup</li>
<li>add the keys to the agent (only once)</li>
</ol>
<h3 id="starting-the-agent">Starting the agent<a class="headerlink" href="#starting-the-agent" title="Permanent link">&para;</a></h3>
<p>The agent can be started manually by running:</p>
<pre><code class="language-bash">eval `ssh-agent`
</code></pre>
<p>We need to evaluate this command as it sets some environment variables. As the process cannot set the environment variables of the parent process due to security reasons, the <code>ssh-agent</code> prints the necessary commands to the console. By using eval, the <code>ssh-agent</code> is executed first, it prints the environment setup commands to stdout, which is captured by the eval command and executed.</p>
<h3 id="listing-keys">Listing keys<a class="headerlink" href="#listing-keys" title="Permanent link">&para;</a></h3>
<p>To list the keys stored in the agent, run:</p>
<pre><code class="language-bash">ssh-add -l
</code></pre>
<h3 id="adding-keys">Adding keys<a class="headerlink" href="#adding-keys" title="Permanent link">&para;</a></h3>
<p>To add a key to the agent, run:</p>
<pre><code class="language-bash">ssh-add &lt;path to key&gt;
</code></pre>
<h3 id="debuging">Debuging<a class="headerlink" href="#debuging" title="Permanent link">&para;</a></h3>
<p>If the agent is running and the key is listed, the first thing to try is to connect via ssh to see whether it is an agent/ssh issue or an issue of the program using the SSH (like git, IDE, file manager...)</p>
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h2>
<p>For configuration, we can use the <code>git config</code> command. There are three levels of configuration:</p>
<ul>
<li><em>system</em>: the configuration is applied to all users on the system. This configuration is set during the installation of git.</li>
<li><em>global</em>: the configuration is applied to all repositories of the current user. This configuration is set by the <code>--global</code> parameter.</li>
<li><em>local</em>: the configuration is applied only to the current repository. This configuration is set by the <code>--local</code> parameter.</li>
</ul>
<p>To list the configuration, use the <code>-l</code>/<code>--list</code> parameter of the <code>git config</code> command. To list the configuration for a specific level, use the <code>--system</code>, <code>--global</code>, <code>--local</code> parameters.</p>
<p>To see the default value of a configuration, search in the <a href="https://git-scm.com/docs/git-config#_variables">git config documentation</a>.</p>
<h2 id="known_hosts-file"><code>known_hosts</code> file<a class="headerlink" href="#known_hosts-file" title="Permanent link">&para;</a></h2>
<p>To know that a connection leads to the desired server and not to some impersonator, the server sends its public key to the client. The client then checks the public key against the list of keys previously set as valid. This list is stored in the <code>.ssh/known_hosts</code> file. The format of the file is:</p>
<pre><code>&lt;server address&gt; &lt;key type&gt; &lt;key&gt;
</code></pre>
<p>Each line contains one server record. What is confusing here is that each server can have multiple records, due to:</p>
<ul>
<li>different key type (e.g., RSA, ECDSA)</li>
<li>key for both host name and IP address (e.g., <code>github.com</code> and <code>140.82.121.3</code>)
It is important to delete/updete all of these recorsds in case the server change its keys.</li>
</ul>
<p>More info is at this <a href="https://security.stackexchange.com/questions/20706/what-is-the-difference-between-authorized-keys-and-known-hosts-file-for-ssh/20710#20710">SO answer</a>.</p>
<h2 id="screen-executing-a-long-running-process-over-ssh">Screen: executing a long running process over SSH<a class="headerlink" href="#screen-executing-a-long-running-process-over-ssh" title="Permanent link">&para;</a></h2>
<p>When the SSH connection to a server is disconnected (either manually, or by network failure or timeout), the process running in the console is canceled. To overcome this limitation, we can use the <code>screen</code> command, which is especially usefull for long running processes.</p>
<p>A typical workflow can look like this:</p>
<ol>
<li>execute <code>screen</code> to start the screen session</li>
<li>run the long running command</li>
<li>disconnect</li>
<li>connect to the server again</li>
<li>run <code>screen -r</code> to recconect to the session and see the results of the command.</li>
<li>after the command is finished, exit the screen session with <code>exit</code></li>
</ol>
<p>Sometimes, the server does not detect the connection failure and do not allow you to resume the session (step 5). In this way, we need to find the screen session ID and perform a detach and atach:</p>
<ol>
<li><code>screen -ls</code></li>
<li>read the ID from the output and exec <code>screen -rd &lt;ID&gt;</code></li>
</ol>
<h2 id="copying-files-over-ssh-using-scp">Copying files over SSH using <code>scp</code><a class="headerlink" href="#copying-files-over-ssh-using-scp" title="Permanent link">&para;</a></h2>
<p>The <code>scp</code> command is used to copy files over SSH. The syntax is:</p>
<pre><code class="language-bash">scp &lt;source&gt; &lt;destination&gt;
</code></pre>
<p>The <code>&lt;source&gt;</code> and <code>&lt;destination&gt;</code> can be either local or remote. The remote files are specified using the <code>&lt;username&gt;@&lt;address&gt;:&lt;path&gt;</code> syntax. </p>
<p>Note that <strong>if the remote path contains spaces, double quoting is necessary</strong>, one for local and one for remote:</p>
<pre><code class="language-bash">scp &lt;source&gt; &quot;&lt;username&gt;@&lt;address&gt;:'&lt;path with spaces&gt;'&quot;
</code></pre>
<h3 id="problems">Problems<a class="headerlink" href="#problems" title="Permanent link">&para;</a></h3>
<ul>
<li><code>protocol error: filename does not match request</code>: This error is triggered if the path contains unexpected characters. Sometimes, it can be triggered even for correct path, if the local console does not match the remote console. In that case, the solution is to use the <code>-T</code> parameter to disable the security check.</li>
</ul>
<h2 id="list-all-active-connections-on-a-server">List all active connections on a server<a class="headerlink" href="#list-all-active-connections-on-a-server" title="Permanent link">&para;</a></h2>
<p>To list all active connections on a server, we can use the <code>lsof</code> command and filter the output for the ssh connections:</p>
<pre><code class="language-bash">lsof -i -n | grep ssh
</code></pre>
<h2 id="wsl-configuration_1">WSL configuration<a class="headerlink" href="#wsl-configuration_1" title="Permanent link">&para;</a></h2>
<ol>
<li>port <code>22</code> can be used on Windows, so change port to <code>2222</code> in <code>sshd_config</code></li>
<li>when loging from Windows use <code>127.0.0.1</code> as a host</li>
</ol>
<h2 id="debugging">Debugging<a class="headerlink" href="#debugging" title="Permanent link">&para;</a></h2>
<p><strong>If the server does not respond:</strong></p>
<ol>
<li>check the ssh status with: <code>service ssh status</code></li>
<li>check the ssh port with <code>sudo netstat -tpln</code></li>
</ol>
<p><strong>If the key is not accepted:</strong>
Check the log file: <code>sudo tail -c 5000 /var/log/auth.log</code></p>
<h1 id="gnu-privacy-guard-gpg">GNU Privacy Guard (GPG)<a class="headerlink" href="#gnu-privacy-guard-gpg" title="Permanent link">&para;</a></h1>
<p><a href="https://en.wikipedia.org/wiki/GNU_Privacy_Guard">GPG</a> is a second most popular tool for encryption, after the SSH keys. Apart from encryption capabilities, it offers also a management of subkeys, and a possibility to revoke the key. It can be downloaded from the <a href="https://gnupg.org/download/">GNU-PG website</a>.</p>
<p>GPG comes with a build in key agent. </p>
<p>To <strong>list</strong> the keys added to the agent, use <code>gpg --list-keys</code>. </p>
<p>To <strong>import</strong> a key, call <code>gpg --import &lt;keyfile&gt;</code>.</p>
<h2 id="key-expiration">Key expiration<a class="headerlink" href="#key-expiration" title="Permanent link">&para;</a></h2>
<p>There is a mechanism for key expiration in GPG. However, it is important to understand that the expiration date is mostly not a security feature! It can be useful in the following cases:</p>
<ul>
<li>you lose access to the key, and nobody else can access it as well. In that case, you cannot revoke the key, but you can just wait until the key expires.</li>
<li>you set the expiration date for subkeys. For subkeys, the expiration date is a security feature, as it cannot be changed without the main key.</li>
</ul>
<p>To prolong the expiration date, we can use the <code>gpg --edit-key &lt;key-id&gt;</code> command. After using it:</p>
<ol>
<li>choose the key you want to edit by number</li>
<li>now the chosen key should be marked with an asterisk <code>*</code>. Enter <code>expire</code> </li>
<li>choose the new expiration date</li>
<li>save the changes by <code>save</code></li>
</ol>
<h2 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">&para;</a></h2>
<h3 id="partial-length-invalid-for-packet-type-63"><code>partial length invalid for packet type 63</code><a class="headerlink" href="#partial-length-invalid-for-packet-type-63" title="Permanent link">&para;</a></h3>
<p>This can happen if the private key has a wrong encoding. It can be fixed by cnverting the key file to ASCII encoding.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/jquery-3.6.0.min.js"></script>
        <script src="../js/bootstrap.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
